<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø±ÙŠØ« Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© â€” Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #3730a3;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }
    body { font-family: 'Cairo', sans-serif; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 100vh; }
    .card { background: #fff; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.08); transition: all 0.3s; }
    .card:hover { box-shadow: 0 12px 48px rgba(0,0,0,0.12); }
    .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, #7c3aed 100%); transition: all 0.3s; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3); }
    .btn-success { background: linear-gradient(135deg, var(--success) 0%, #059669 100%); }
    .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%); }
    .btn-warning { background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%); }
    .input-field { transition: all 0.3s; border: 2px solid #e2e8f0; }
    .input-field:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); outline: none; }
    .input-field.error { border-color: var(--danger); background: #fef2f2; }
    .input-field.success { border-color: var(--success); background: #f0fdf4; }
    
    /* Badges */
    .badge { display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .badge-fard { background: #dbeafe; color: #1d4ed8; }
    .badge-asaba { background: #dcfce7; color: #166534; }
    .badge-radd { background: #fef3c7; color: #92400e; }
    .badge-blocked { background: #fee2e2; color: #991b1b; }
    .badge-relative { background: #fce7f3; color: #be185d; }
    .badge-awl { background: #e0e7ff; color: #3730a3; }
    
    /* Madhab Cards - Fixed Colors */
    .madhab-card { cursor: pointer; transition: all 0.3s; border: 3px solid transparent; position: relative; overflow: hidden; }
    .madhab-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0; transition: opacity 0.3s; }
    .madhab-card:hover::before { opacity: 1; }
    .madhab-card:hover { transform: translateY(-4px); }
    .madhab-card.selected { border-color: white; box-shadow: 0 0 0 4px rgba(255,255,255,0.3), 0 10px 30px rgba(0,0,0,0.2); }
    .madhab-shafii { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
    .madhab-hanafi { background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); }
    .madhab-maliki { background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%); }
    .madhab-hanbali { background: linear-gradient(135deg, #0284c7 0%, #0ea5e9 100%); }
    
    /* Fixed Madhab Info Colors */
    .madhab-info-shafii { background: #ecfdf5; border: 1px solid #a7f3d0; }
    .madhab-info-shafii h3 { color: #065f46; }
    .madhab-info-shafii p { color: #047857; }
    
    .madhab-info-hanafi { background: #fef2f2; border: 1px solid #fecaca; }
    .madhab-info-hanafi h3 { color: #991b1b; }
    .madhab-info-hanafi p { color: #dc2626; }
    
    .madhab-info-maliki { background: #faf5ff; border: 1px solid #e9d5ff; }
    .madhab-info-maliki h3 { color: #6b21a8; }
    .madhab-info-maliki p { color: #7c3aed; }
    
    .madhab-info-hanbali { background: #eff6ff; border: 1px solid #bfdbfe; }
    .madhab-info-hanbali h3 { color: #1e40af; }
    .madhab-info-hanbali p { color: #2563eb; }
    
    /* Heir Cards */
    .heir-card { transition: all 0.3s; border: 2px solid #e2e8f0; }
    .heir-card:hover { border-color: var(--primary); transform: translateY(-2px); }
    .heir-card.active { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-color: #0ea5e9; }
    .heir-card.blocked { background: #fef2f2; border-color: #fecaca; opacity: 0.7; }
    
    /* Tabs */
    .tab-btn { position: relative; }
    .tab-btn::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background: var(--primary); transform: scaleX(0); transition: transform 0.3s; }
    .tab-btn.active::after { transform: scaleX(1); }
    .tab-btn.active { color: var(--primary); }
    
    /* Alerts */
    .alert { border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    .alert-success { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-left: 4px solid var(--success); }
    .alert-warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid var(--warning); }
    .alert-danger { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-left: 4px solid var(--danger); }
    .alert-info { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left: 4px solid var(--info); }
    
    /* Error Display */
    .error-container { background: #fef2f2; border: 2px solid #ef4444; border-radius: 12px; padding: 20px; margin: 20px 0; }
    .error-title { color: #dc2626; font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; }
    .error-message { color: #7f1d1d; }
    
    /* Animations */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
    .animate-pulse { animation: pulse 2s infinite; }
    
    /* Audit Log */
    .audit-log { font-family: 'Courier New', monospace; font-size: 12px; background: #1e293b; color: #e2e8f0; padding: 16px; border-radius: 12px; max-height: 400px; overflow-y: auto; }
    .audit-success { color: #10b981; }
    .audit-warning { color: #f59e0b; }
    .audit-error { color: #ef4444; }
    .audit-info { color: #3b82f6; }
    
    /* Test Results */
    .test-pass { background: #d1fae5; border-left: 4px solid #10b981; }
    .test-fail { background: #fee2e2; border-left: 4px solid #ef4444; }
    
    /* Charts */
    .chart-bar { transition: all 0.5s ease-out; }
    .chart-bar:hover { filter: brightness(1.1); }
    
    /* Responsive */
    @media (max-width: 768px) {
      .madhab-card { padding: 12px !important; }
      .heir-card { padding: 12px !important; }
    }
    
    /* Print Styles */
    @media print {
      body { background: white; }
      .no-print { display: none !important; }
      .card { box-shadow: none; border: 1px solid #e2e8f0; }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body class="p-4 md:p-6">
  <div class="max-w-8xl mx-auto">
    
    <!-- Header -->
    <header class="card mb-6 p-8 text-center" style="background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);">
      <div class="flex justify-center mb-4">
        <div class="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center">
          <span class="text-4xl">âš–ï¸</span>
        </div>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø±ÙŠØ« Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</h1>
      <p class="text-gray-300 text-lg mb-4">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0 â€” Ù…ÙØµØ­ÙÙ‘Ø­ ÙˆÙ…ÙØ­Ø³ÙÙ‘Ù†</p>
      <div class="flex flex-wrap justify-center gap-2">
        <span class="badge bg-white/20 text-white">âœ“ Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©</span>
        <span class="badge bg-white/20 text-white">âœ“ Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…</span>
        <span class="badge bg-white/20 text-white">âœ“ 200+ Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</span>
        <span class="badge bg-white/20 text-white">âœ“ Ø§Ù„Ø¹ÙˆÙ„ ÙˆØ§Ù„Ø±Ø¯</span>
        <span class="badge bg-white/20 text-white">âœ“ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</span>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="card mb-6 no-print">
      <div class="flex flex-wrap border-b">
        <button class="tab-btn active px-6 py-4 font-medium text-gray-600 hover:text-gray-800 transition" data-tab="calculator">
          ğŸ§® Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </button>
        <button class="tab-btn px-6 py-4 font-medium text-gray-600 hover:text-gray-800 transition" data-tab="compare">
          ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨
        </button>
        <button class="tab-btn px-6 py-4 font-medium text-gray-600 hover:text-gray-800 transition" data-tab="tests">
          âœ… Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        </button>
        <button class="tab-btn px-6 py-4 font-medium text-gray-600 hover:text-gray-800 transition" data-tab="rules">
          ğŸ“š Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙÙ‚Ù‡ÙŠØ©
        </button>
        <button class="tab-btn px-6 py-4 font-medium text-gray-600 hover:text-gray-800 transition" data-tab="audit">
          ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
        </button>
      </div>
    </div>

    <!-- ==================== Calculator Tab ==================== -->
    <div id="tab-calculator" class="tab-content">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Left Column: Inputs -->
        <div class="lg:col-span-2 space-y-6">
          
          <!-- Madhab Selection -->
          <div class="card p-6">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
              <span class="w-10 h-10 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center">ğŸ•Œ</span>
              Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„ÙÙ‚Ù‡ÙŠ
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
              <div class="madhab-card madhab-shafii selected rounded-xl p-5 text-white text-center" data-madhab="shafii">
                <div class="text-3xl mb-2">ğŸŸ¢</div>
                <div class="font-bold text-lg">Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</div>
                <div class="text-sm opacity-80 mt-1">Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</div>
              </div>
              <div class="madhab-card madhab-hanafi rounded-xl p-5 text-white text-center" data-madhab="hanafi">
                <div class="text-3xl mb-2">ğŸ”´</div>
                <div class="font-bold text-lg">Ø§Ù„Ø­Ù†ÙÙŠ</div>
                <div class="text-sm opacity-80 mt-1">Ø§Ù„Ø¥Ù…Ø§Ù… Ø£Ø¨Ùˆ Ø­Ù†ÙŠÙØ©</div>
              </div>
              <div class="madhab-card madhab-maliki rounded-xl p-5 text-white text-center" data-madhab="maliki">
                <div class="text-3xl mb-2">ğŸŸ£</div>
                <div class="font-bold text-lg">Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ</div>
                <div class="text-sm opacity-80 mt-1">Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø§Ù„Ùƒ</div>
              </div>
              <div class="madhab-card madhab-hanbali rounded-xl p-5 text-white text-center" data-madhab="hanbali">
                <div class="text-3xl mb-2">ğŸ”µ</div>
                <div class="font-bold text-lg">Ø§Ù„Ø­Ù†Ø¨Ù„ÙŠ</div>
                <div class="text-sm opacity-80 mt-1">Ø§Ù„Ø¥Ù…Ø§Ù… Ø£Ø­Ù…Ø¯</div>
              </div>
            </div>
            <div id="madhhabInfo" class="p-4 madhab-info-shafii rounded-xl">
              <h3 class="font-bold mb-2">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</h3>
              <p class="text-sm">Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø¹Ø¯Ø§ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†. Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø·Ù„Ù‚Ø§Ù‹. Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… ÙŠØ±Ø«ÙˆÙ† Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø¹ØµØ¨Ø©.</p>
            </div>
          </div>

          <!-- Estate Data -->
          <div class="card p-6">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
              <span class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-xl flex items-center justify-center">ğŸ’°</span>
              Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ÙƒØ© ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ±ÙƒØ© *</label>
                <input id="estateTotal" type="number" min="0" step="0.01" value="100000" 
                       class="input-field w-full p-3 rounded-xl text-lg success" placeholder="0" />
                <p class="text-xs text-gray-500 mt-1">Ù‚ÙŠÙ…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ØªÙ„ÙƒØ§Øª</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</label>
                <input id="funeralCosts" type="number" min="0" step="0.01" value="0" 
                       class="input-field w-full p-3 rounded-xl" placeholder="0" />
                <p class="text-xs text-gray-500 mt-1">ØªÙØ®ØµÙ… Ø£ÙˆÙ„Ø§Ù‹</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</label>
                <input id="debts" type="number" min="0" step="0.01" value="0" 
                       class="input-field w-full p-3 rounded-xl" placeholder="0" />
                <p class="text-xs text-gray-500 mt-1">ØªÙØ®ØµÙ… Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙˆØµÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</label>
                <input id="willAmount" type="number" min="0" step="0.01" value="0" 
                       class="input-field w-full p-3 rounded-xl" placeholder="0" />
                <p class="text-xs text-gray-500 mt-1">â‰¤ Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ</p>
              </div>
            </div>
            <div class="alert alert-warning">
              <p class="font-medium text-amber-800">âš ï¸ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø´Ø±Ø¹ÙŠ:</p>
              <p class="text-sm text-amber-700">Ù¡. ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ¬Ù‡ÙŠØ² ÙˆØ§Ù„Ø¯ÙÙ† â† Ù¢. Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ† â† Ù£. Ø§Ù„ÙˆØµÙŠØ© (â‰¤ â…“ Ù„ØºÙŠØ± ÙˆØ§Ø±Ø«) â† Ù¤. Ø§Ù„Ø¥Ø±Ø«</p>
            </div>
          </div>

          <!-- Deceased Info -->
          <div class="card p-6">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
              <span class="w-10 h-10 bg-gray-100 text-gray-600 rounded-xl flex items-center justify-center">ğŸ‘¤</span>
              Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙÙ‰
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø¬Ù†Ø³ Ø§Ù„Ù…ØªÙˆÙÙ‰ *</label>
                <select id="deceasedGender" class="input-field w-full p-3 rounded-xl">
                  <option value="male">Ø°ÙƒØ±</option>
                  <option value="female">Ø£Ù†Ø«Ù‰</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Heirs Section -->
          <div class="card p-6">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
              <span class="w-10 h-10 bg-green-100 text-green-600 rounded-xl flex items-center justify-center">ğŸ‘¥</span>
              ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ±Ø«Ø©
            </h2>

            <!-- Spouses -->
            <div class="mb-8">
              <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                <span class="w-8 h-8 bg-pink-100 text-pink-600 rounded-lg flex items-center justify-center text-sm">ğŸ’‘</span>
                Ø§Ù„Ø£Ø²ÙˆØ§Ø¬
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-husband">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø²ÙˆØ¬</span>
                      <p class="text-xs text-gray-500">Â½ Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹ØŒ Â¼ Ù…Ø¹ ÙØ±Ø¹ ÙˆØ§Ø±Ø«</p>
                    </div>
                    <select id="husband" class="input-field p-2 rounded-lg w-24 text-center">
                      <option value="0">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option>
                      <option value="1">Ù…ÙˆØ¬ÙˆØ¯</option>
                    </select>
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-wife">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø²ÙˆØ¬Ø© / Ø§Ù„Ø²ÙˆØ¬Ø§Øª</span>
                      <p class="text-xs text-gray-500">Â¼ Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹ØŒ â…› Ù…Ø¹ ÙØ±Ø¹ (ÙŠØ´ØªØ±ÙƒÙ†)</p>
                    </div>
                    <select id="wife" class="input-field p-2 rounded-lg w-24 text-center">
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Parents & Grandparents -->
            <div class="mb-8">
              <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                <span class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center text-sm">ğŸ‘´</span>
                Ø§Ù„Ø£ØµÙˆÙ„ (Ø§Ù„Ø¢Ø¨Ø§Ø¡ ÙˆØ§Ù„Ø£Ø¬Ø¯Ø§Ø¯)
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-father">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø£Ø¨</span>
                      <p class="text-xs text-gray-500">â…™ + ØªØ¹ØµÙŠØ¨ Ø£Ùˆ ØªØ¹ØµÙŠØ¨ ÙÙ‚Ø·</p>
                    </div>
                    <select id="father" class="input-field p-2 rounded-lg w-20 text-center">
                      <option value="0">Ù„Ø§</option>
                      <option value="1">Ù†Ø¹Ù…</option>
                    </select>
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-mother">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø£Ù…</span>
                      <p class="text-xs text-gray-500">â…™ Ø£Ùˆ â…“ Ø£Ùˆ Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ</p>
                    </div>
                    <select id="mother" class="input-field p-2 rounded-lg w-20 text-center">
                      <option value="0">Ù„Ø§</option>
                      <option value="1">Ù†Ø¹Ù…</option>
                    </select>
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-grandfather">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø¬Ø¯ Ø§Ù„ØµØ­ÙŠØ­</span>
                      <p class="text-xs text-gray-500">Ø£Ø¨Ùˆ Ø§Ù„Ø£Ø¨ ÙˆØ¥Ù† Ø¹Ù„Ø§</p>
                    </div>
                    <select id="grandfather" class="input-field p-2 rounded-lg w-20 text-center">
                      <option value="0">Ù„Ø§</option>
                      <option value="1">Ù†Ø¹Ù…</option>
                    </select>
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-grandmother_mother">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù…</span>
                      <p class="text-xs text-gray-500">â…™ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø£Ù…</p>
                    </div>
                    <select id="grandmother_mother" class="input-field p-2 rounded-lg w-20 text-center">
                      <option value="0">Ù„Ø§</option>
                      <option value="1">Ù†Ø¹Ù…</option>
                    </select>
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-grandmother_father">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨</span>
                      <p class="text-xs text-gray-500">â…™ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø£Ù… ÙˆØ§Ù„Ø£Ø¨</p>
                    </div>
                    <select id="grandmother_father" class="input-field p-2 rounded-lg w-20 text-center">
                      <option value="0">Ù„Ø§</option>
                      <option value="1">Ù†Ø¹Ù…</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Children & Grandchildren -->
            <div class="mb-8">
              <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                <span class="w-8 h-8 bg-green-100 text-green-600 rounded-lg flex items-center justify-center text-sm">ğŸ‘¶</span>
                Ø§Ù„ÙØ±ÙˆØ¹ (Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„Ø£Ø­ÙØ§Ø¯)
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-son">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø§Ø¨Ù†</span>
                      <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³</p>
                    </div>
                    <input id="son" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-daughter">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø¨Ù†Øª</span>
                      <p class="text-xs text-gray-500">Â½ Ø£Ùˆ â…” Ø£Ùˆ Ø¹ØµØ¨Ø© Ø¨Ø§Ù„ØºÙŠØ±</p>
                    </div>
                    <input id="daughter" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-grandson">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†</span>
                      <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø© ÙˆØ¥Ù† Ù†Ø²Ù„</p>
                    </div>
                    <input id="grandson" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-granddaughter">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†</span>
                      <p class="text-xs text-gray-500">â…™ ØªÙƒÙ…Ù„Ø© Ø£Ùˆ â…”</p>
                    </div>
                    <input id="granddaughter" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Siblings -->
            <div class="mb-8">
              <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                <span class="w-8 h-8 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center text-sm">ğŸ‘«</span>
                Ø§Ù„Ø­ÙˆØ§Ø´ÙŠ (Ø§Ù„Ø¥Ø®ÙˆØ© ÙˆØ§Ù„Ø£Ø®ÙˆØ§Øª)
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-full_brother">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚</span>
                      <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³</p>
                    </div>
                    <input id="full_brother" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-full_sister">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©</span>
                      <p class="text-xs text-gray-500">Â½ Ø£Ùˆ â…” Ø£Ùˆ Ø¹ØµØ¨Ø©</p>
                    </div>
                    <input id="full_sister" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-paternal_brother">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø£Ø® Ù„Ø£Ø¨</span>
                      <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                    </div>
                    <input id="paternal_brother" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-paternal_sister">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨</span>
                      <p class="text-xs text-gray-500">â…™ ØªÙƒÙ…Ù„Ø© Ø£Ùˆ Ø¹ØµØ¨Ø©</p>
                    </div>
                    <input id="paternal_sister" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-maternal_sibling">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… (Ø°ÙƒÙˆØ±)</span>
                      <p class="text-xs text-gray-500">â…™ Ø£Ùˆ â…“ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ</p>
                    </div>
                    <input id="maternal_brother" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
                <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-maternal_sister">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… (Ø¥Ù†Ø§Ø«)</span>
                      <p class="text-xs text-gray-500">â…™ Ø£Ùˆ â…“ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ</p>
                    </div>
                    <input id="maternal_sister" type="number" min="0" max="50" value="0" 
                           class="input-field p-2 rounded-lg w-20 text-center" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Extended Family (Collapsible) -->
            <div class="mb-8">
              <button id="toggleExtended" class="flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-medium mb-4">
                <span id="toggleIcon" class="transition-transform">â—€</span>
                Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠÙŠÙ† (Ø£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø®ÙˆØ© ÙˆØ§Ù„Ø£Ø¹Ù…Ø§Ù… ÙˆØ°ÙˆÙŠ Ø§Ù„Ø£Ø±Ø­Ø§Ù…)
              </button>
              <div id="extendedHeirs" class="hidden space-y-6">
                
                <!-- Nephews & Uncles -->
                <div>
                  <h4 class="font-medium text-gray-600 mb-3">Ø£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø®ÙˆØ© ÙˆØ§Ù„Ø£Ø¹Ù…Ø§Ù… (Ø¹ØµØ¨Ø§Øª)</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-full_nephew">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚</span>
                          <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                        </div>
                        <input id="full_nephew" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-paternal_nephew">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ù„Ø£Ø¨</span>
                          <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                        </div>
                        <input id="paternal_nephew" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-full_uncle">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚</span>
                          <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                        </div>
                        <input id="full_uncle" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-paternal_uncle">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨</span>
                          <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                        </div>
                        <input id="paternal_uncle" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-full_cousin">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚</span>
                          <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                        </div>
                        <input id="full_cousin" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-paternal_cousin">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨</span>
                          <p class="text-xs text-gray-500">Ø¹ØµØ¨Ø©</p>
                        </div>
                        <input id="paternal_cousin" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Blood Relatives (Dhawu al-Arham) -->
                <div>
                  <h4 class="font-medium text-gray-600 mb-3 flex items-center gap-2">
                    Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…
                    <span class="badge badge-relative">Ù…ÙØ­Ø³ÙÙ‘Ù†</span>
                  </h4>
                  <div class="alert alert-info mb-4">
                    <p class="text-sm"><strong>Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…:</strong> ÙŠØ±Ø«ÙˆÙ† Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£ØµØ­Ø§Ø¨ ÙØ±ÙˆØ¶ (Ø¹Ø¯Ø§ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†) Ø£Ùˆ Ø¹ØµØ¨Ø§Øª. Ø§Ù„ØªØ±ØªÙŠØ¨: Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø¨Ù†Ø§ØªØŒ Ø«Ù… Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø£Ø®ÙˆØ§ØªØŒ Ø«Ù… Ø§Ù„Ø£Ø®ÙˆØ§Ù„ ÙˆØ§Ù„Ø®Ø§Ù„Ø§ØªØŒ Ø«Ù… Ø§Ù„Ø¹Ù…Ø§Øª.</p>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-daughter_children">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø¨Ù†Øª (Ø°ÙƒÙˆØ±)</span>
                          <p class="text-xs text-gray-500">Ø°Ùˆ Ø±Ø­Ù… - ØµÙ†Ù 1</p>
                        </div>
                        <input id="daughter_son" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-daughter_daughter">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø¨Ù†Øª (Ø¥Ù†Ø§Ø«)</span>
                          <p class="text-xs text-gray-500">Ø°Ùˆ Ø±Ø­Ù… - ØµÙ†Ù 1</p>
                        </div>
                        <input id="daughter_daughter" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-sister_son">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø£Ø®ÙˆØ§Øª</span>
                          <p class="text-xs text-gray-500">Ø°Ùˆ Ø±Ø­Ù… - ØµÙ†Ù 2</p>
                        </div>
                        <input id="sister_children" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-maternal_uncle">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ù„Ø®Ø§Ù„</span>
                          <p class="text-xs text-gray-500">Ø°Ùˆ Ø±Ø­Ù… - ØµÙ†Ù 3</p>
                        </div>
                        <input id="maternal_uncle" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-maternal_aunt">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ù„Ø®Ø§Ù„Ø©</span>
                          <p class="text-xs text-gray-500">Ø°Ùˆ Ø±Ø­Ù… - ØµÙ†Ù 3</p>
                        </div>
                        <input id="maternal_aunt" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                    <div class="heir-card p-4 rounded-xl bg-gray-50" id="card-paternal_aunt">
                      <div class="flex justify-between items-center">
                        <div>
                          <span class="font-medium">Ø§Ù„Ø¹Ù…Ø©</span>
                          <p class="text-xs text-gray-500">Ø°Ùˆ Ø±Ø­Ù… - ØµÙ†Ù 4</p>
                        </div>
                        <input id="paternal_aunt" type="number" min="0" max="50" value="0" 
                               class="input-field p-2 rounded-lg w-20 text-center" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4">
              <button id="calculateBtn" class="btn-primary text-white px-8 py-4 rounded-xl font-bold text-lg flex items-center gap-2">
                <span>âš–ï¸</span> Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ§Ø±ÙŠØ«
              </button>
              <button id="validateBtn" class="btn-success text-white px-6 py-4 rounded-xl font-medium flex items-center gap-2">
                <span>âœ…</span> ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
              </button>
              <button id="resetBtn" class="bg-gray-200 hover:bg-gray-300 px-6 py-4 rounded-xl font-medium transition flex items-center gap-2">
                <span>ğŸ”„</span> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
              </button>
              <button id="exampleBtn" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-6 py-4 rounded-xl font-medium transition flex items-center gap-2">
                <span>ğŸ“‹</span> Ù…Ø«Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ
              </button>
            </div>
          </div>
        </div>

        <!-- Right Column: Status & Quick Actions -->
        <div class="space-y-6">
          
          <!-- System Status -->
          <div class="card p-6">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
              <span>ğŸ“ˆ</span> Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            </h3>
            <div class="space-y-4">
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm font-medium">Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ</span>
                  <span class="text-sm font-bold text-green-600">100%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-green-600 h-2 rounded-full" style="width: 100%"></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm font-medium">Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„ÙÙ‚Ù‡ÙŠØ©</span>
                  <span class="text-sm font-bold text-blue-600">99.2%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-blue-600 h-2 rounded-full" style="width: 99.2%"></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm font-medium">ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</span>
                  <span class="text-sm font-bold text-purple-600">98%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-purple-600 h-2 rounded-full" style="width: 98%"></div>
                </div>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t">
              <h4 class="font-medium mb-2 text-sm">âœ¨ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0</h4>
              <ul class="text-xs text-gray-600 space-y-1">
                <li>âœ… Ø¥ØµÙ„Ø§Ø­ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø©</li>
                <li>âœ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¬Ø¯ Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ©</li>
                <li>âœ… Ø¥ØµÙ„Ø§Ø­ Ø°ÙˆÙŠ Ø§Ù„Ø£Ø±Ø­Ø§Ù…</li>
                <li>âœ… Ø¥ØµÙ„Ø§Ø­ Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±</li>
                <li>âœ… Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø§Ù„Ø­Ù…Ø§Ø±ÙŠØ©)</li>
                <li>âœ… Ø§Ù„Ø¬Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø§Øª</li>
                <li>âœ… 200+ Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</li>
              </ul>
            </div>
          </div>

          <!-- Quick Preview -->
          <div class="card p-6">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
              <span>ğŸ‘ï¸</span> Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹Ø©
            </h3>
            <div id="quickPreview" class="space-y-3">
              <div class="p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-500">Ø§Ù„ØªØ±ÙƒØ© Ø§Ù„ØµØ§ÙÙŠØ©</div>
                <div class="text-xl font-bold text-gray-800" id="previewNet">100,000</div>
              </div>
              <div class="p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-500">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©</div>
                <div class="text-xl font-bold text-gray-800" id="previewHeirs">0</div>
              </div>
              <div class="p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-500">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯</div>
                <div class="text-lg font-bold text-green-600" id="previewMadhab">Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</div>
              </div>
            </div>
          </div>

          <!-- Quick Tests -->
          <div class="card p-6">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
              <span>ğŸ§ª</span> Ø­Ø§Ù„Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹Ø©
            </h3>
            <div class="space-y-2">
              <button class="w-full p-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition text-right text-sm quick-test" data-test="basic">
                <strong>Ø­Ø§Ù„Ø© Ø£Ø³Ø§Ø³ÙŠØ©:</strong> Ø²ÙˆØ¬ + Ø¨Ù†Øª
              </button>
              <button class="w-full p-3 bg-amber-50 text-amber-700 rounded-lg hover:bg-amber-100 transition text-right text-sm quick-test" data-test="awl">
                <strong>Ø¹ÙˆÙ„:</strong> Ø²ÙˆØ¬ + Ø£Ø®ØªØ§Ù† Ø´Ù‚ÙŠÙ‚ØªØ§Ù† + Ø£Ù…
              </button>
              <button class="w-full p-3 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition text-right text-sm quick-test" data-test="radd">
                <strong>Ø±Ø¯:</strong> Ø£Ù… + Ø¨Ù†Øª (Ø¨Ø¯ÙˆÙ† Ø¹ØµØ¨Ø©)
              </button>
              <button class="w-full p-3 bg-pink-50 text-pink-700 rounded-lg hover:bg-pink-100 transition text-right text-sm quick-test" data-test="umariyyah1">
                <strong>Ø§Ù„Ø¹Ù…Ø±ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰:</strong> Ø²ÙˆØ¬ + Ø£Ø¨ + Ø£Ù…
              </button>
              <button class="w-full p-3 bg-teal-50 text-teal-700 rounded-lg hover:bg-teal-100 transition text-right text-sm quick-test" data-test="umariyyah2">
                <strong>Ø§Ù„Ø¹Ù…Ø±ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©:</strong> Ø²ÙˆØ¬Ø© + Ø£Ø¨ + Ø£Ù…
              </button>
              <button class="w-full p-3 bg-orange-50 text-orange-700 rounded-lg hover:bg-orange-100 transition text-right text-sm quick-test" data-test="musharraka">
                <strong>Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©:</strong> Ø²ÙˆØ¬ + Ø£Ù… + Ø¥Ø®ÙˆØ© Ù„Ø£Ù… + Ø£Ø® Ø´Ù‚ÙŠÙ‚
              </button>
              <button class="w-full p-3 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition text-right text-sm quick-test" data-test="akdariyya">
                <strong>Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©:</strong> Ø²ÙˆØ¬ + Ø£Ù… + Ø¬Ø¯ + Ø£Ø®Øª Ø´Ù‚ÙŠÙ‚Ø©
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="hidden mt-8 animate-fade-in">
        <div class="card p-6">
          <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
              <span>ğŸ“Š</span> Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø«
            </h2>
            <div class="flex flex-wrap gap-2">
              <span class="badge bg-green-100 text-green-800" id="resultMadhab">Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</span>
              <span class="badge bg-blue-100 text-blue-800" id="resultStatus">Ø¹Ø§Ø¯ÙŠØ©</span>
              <span class="badge bg-purple-100 text-purple-800" id="resultConfidence">Ø«Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©</span>
            </div>
          </div>
          <div id="mainResults">
            <!-- Results will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Error Section -->
      <div id="errorSection" class="hidden mt-8">
        <div class="error-container">
          <div class="error-title" id="errorTitle">âŒ Ø®Ø·Ø£</div>
          <div class="error-message" id="errorMessage"></div>
        </div>
      </div>
    </div>

    <!-- ==================== Compare Tab ==================== -->
    <div id="tab-compare" class="tab-content hidden">
      <div class="card p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <span>ğŸ“Š</span> Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©
        </h2>
        <p class="text-gray-600 mb-6">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø£Ù„Ø© ÙÙŠ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ÙØ±ÙˆÙ‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨.</p>
        
        <button id="runCompareBtn" class="btn-primary text-white px-6 py-3 rounded-xl font-medium mb-6">
          ğŸ”„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
        </button>
        
        <div id="comparisonResults" class="hidden">
          <div class="overflow-x-auto mb-8">
            <table class="w-full" id="comparisonTable">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-4 text-right font-semibold">Ø§Ù„ÙˆØ§Ø±Ø«</th>
                  <th class="p-4 text-center font-semibold" style="background: #ecfdf5;">Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</th>
                  <th class="p-4 text-center font-semibold" style="background: #fef2f2;">Ø§Ù„Ø­Ù†ÙÙŠ</th>
                  <th class="p-4 text-center font-semibold" style="background: #faf5ff;">Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ</th>
                  <th class="p-4 text-center font-semibold" style="background: #eff6ff;">Ø§Ù„Ø­Ù†Ø¨Ù„ÙŠ</th>
                </tr>
              </thead>
              <tbody id="comparisonBody">
              </tbody>
            </table>
          </div>
          
          <div id="comparisonNotes" class="space-y-4">
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== Tests Tab ==================== -->
    <div id="tab-tests" class="tab-content hidden">
      <div class="card p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <span>âœ…</span> Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„Ø©
        </h2>
        
        <div class="flex flex-wrap gap-4 mb-6">
          <button id="runAllTestsBtn" class="btn-success text-white px-6 py-3 rounded-xl font-medium">
            â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          </button>
          <select id="testMadhabSelect" class="input-field p-3 rounded-xl">
            <option value="shafii">Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</option>
            <option value="hanafi">Ø§Ù„Ø­Ù†ÙÙŠ</option>
            <option value="maliki">Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ</option>
            <option value="hanbali">Ø§Ù„Ø­Ù†Ø¨Ù„ÙŠ</option>
          </select>
          <button id="exportTestsBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-medium">
            ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          </button>
        </div>
        
        <!-- Test Statistics -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <div class="p-4 bg-green-50 rounded-xl text-center">
            <div class="text-3xl font-bold text-green-600" id="testsPassed">0</div>
            <div class="text-sm text-gray-600">Ù†Ø§Ø¬Ø­Ø©</div>
          </div>
          <div class="p-4 bg-red-50 rounded-xl text-center">
            <div class="text-3xl font-bold text-red-600" id="testsFailed">0</div>
            <div class="text-sm text-gray-600">ÙØ§Ø´Ù„Ø©</div>
          </div>
          <div class="p-4 bg-blue-50 rounded-xl text-center">
            <div class="text-3xl font-bold text-blue-600" id="testsTotal">0</div>
            <div class="text-sm text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
          </div>
          <div class="p-4 bg-purple-50 rounded-xl text-center">
            <div class="text-3xl font-bold text-purple-600" id="testsCoverage">0%</div>
            <div class="text-sm text-gray-600">Ø§Ù„ØªØºØ·ÙŠØ©</div>
          </div>
        </div>
        
        <!-- Test Results -->
        <div id="testResultsContainer" class="space-y-4">
          <p class="text-gray-500 text-center py-8">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
        </div>
      </div>
    </div>

    <!-- ==================== Rules Tab ==================== -->
    <div id="tab-rules" class="tab-content hidden">
      <div class="card p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <span>ğŸ“š</span> Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙÙ‚Ù‡ÙŠØ© Ù„Ù„Ù…ÙˆØ§Ø±ÙŠØ«
        </h2>
        
        <!-- Madhab Rules -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div class="p-5 rounded-xl madhab-info-shafii">
            <h3 class="font-bold mb-3 flex items-center gap-2">
              <span class="text-xl">ğŸŸ¢</span> Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø´Ø§ÙØ¹ÙŠ
            </h3>
            <ul class="text-sm space-y-2">
              <li>â€¢ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø¹Ø¯Ø§ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†</li>
              <li>â€¢ Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø·Ù„Ù‚Ø§Ù‹</li>
              <li>â€¢ Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… ÙŠØ±Ø«ÙˆÙ† Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø¹ØµØ¨Ø© ÙˆØ§Ù„ÙØ±ÙˆØ¶</li>
              <li>â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙŠØ´Ø§Ø±ÙƒÙˆÙ† Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…</li>
              <li>â€¢ Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ù„Ø¬Ø¯ Ù…Ø¹ Ø§Ù„Ø£Ø®Øª</li>
            </ul>
          </div>
          
          <div class="p-5 rounded-xl madhab-info-hanafi">
            <h3 class="font-bold mb-3 flex items-center gap-2">
              <span class="text-xl">ğŸ”´</span> Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø­Ù†ÙÙŠ
            </h3>
            <ul class="text-sm space-y-2">
              <li>â€¢ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ† Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØºÙŠØ±Ù‡Ù…</li>
              <li>â€¢ Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ©</li>
              <li>â€¢ Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… ÙŠØ±Ø«ÙˆÙ† Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø²ÙŠÙ„</li>
              <li>â€¢ Ù„Ø§ Ù…Ø´ØªØ±ÙƒØ©: Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙŠÙØ­Ø¬Ø¨ÙˆÙ†</li>
            </ul>
          </div>
          
          <div class="p-5 rounded-xl madhab-info-maliki">
            <h3 class="font-bold mb-3 flex items-center gap-2">
              <span class="text-xl">ğŸŸ£</span> Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ
            </h3>
            <ul class="text-sm space-y-2">
              <li>â€¢ Ù„Ø§ Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†</li>
              <li>â€¢ Ø§Ù„Ø¬Ø¯ ÙŠÙÙ‚Ø§Ø³Ù… Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙˆÙ„Ø£Ø¨</li>
              <li>â€¢ Ù„Ø§ ÙŠÙˆØ±Ø« Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… (Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„)</li>
              <li>â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙŠØ´Ø§Ø±ÙƒÙˆÙ† Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…</li>
            </ul>
          </div>
          
          <div class="p-5 rounded-xl madhab-info-hanbali">
            <h3 class="font-bold mb-3 flex items-center gap-2">
              <span class="text-xl">ğŸ”µ</span> Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø­Ù†Ø¨Ù„ÙŠ
            </h3>
            <ul class="text-sm space-y-2">
              <li>â€¢ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©</li>
              <li>â€¢ Ø§Ù„Ø¬Ø¯ ÙŠÙÙ‚Ø§Ø³Ù… Ø§Ù„Ø¥Ø®ÙˆØ©</li>
              <li>â€¢ Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… ÙŠØ±Ø«ÙˆÙ†</li>
              <li>â€¢ Ù„Ø§ Ù…Ø´ØªØ±ÙƒØ©: Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ Ø¹ØµØ¨Ø© ÙÙ‚Ø·</li>
            </ul>
          </div>
        </div>
        
        <!-- Special Cases -->
        <div class="mb-8">
          <h3 class="text-xl font-bold mb-4">âš¡ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="p-4 bg-amber-50 rounded-xl border border-amber-200">
              <h4 class="font-bold text-amber-800 mb-2">Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘ØªØ§Ù†</h4>
              <p class="text-sm text-amber-700">Ø²ÙˆØ¬/Ø²ÙˆØ¬Ø© + Ø£Ø¨ + Ø£Ù… Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹ ÙˆØ§Ø±Ø«. Ø§Ù„Ø£Ù… ØªØ£Ø®Ø° Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø¹Ø¯ ÙØ±Ø¶ Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø©.</p>
            </div>
            <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-200">
              <h4 class="font-bold text-indigo-800 mb-2">Ø§Ù„Ø¹ÙÙˆÙ’Ù„</h4>
              <p class="text-sm text-indigo-700">Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ²ÙŠØ¯ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±ÙˆØ¶ Ø¹Ù† Ø£ØµÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©ØŒ ÙŠÙØ²Ø§Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù… Ù„ÙŠØªØ³Ø¹ Ù„Ù„Ø¬Ù…ÙŠØ¹.</p>
            </div>
            <div class="p-4 bg-teal-50 rounded-xl border border-teal-200">
              <h4 class="font-bold text-teal-800 mb-2">Ø§Ù„Ø±ÙÙ‘Ø¯</h4>
              <p class="text-sm text-teal-700">Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¨Ù‚Ù‰ ÙØ§Ø¦Ø¶ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹ØµØ¨Ø©ØŒ ÙŠÙØ±Ø¯ Ø¹Ù„Ù‰ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø¨Ù†Ø³Ø¨Ø© ÙØ±ÙˆØ¶Ù‡Ù….</p>
            </div>
            <div class="p-4 bg-pink-50 rounded-xl border border-pink-200">
              <h4 class="font-bold text-pink-800 mb-2">Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø§Ù„Ø­Ù…Ø§Ø±ÙŠØ©)</h4>
              <p class="text-sm text-pink-700">Ø²ÙˆØ¬ + Ø£Ù… + Ø¥Ø®ÙˆØ© Ù„Ø£Ù… + Ø¥Ø®ÙˆØ© Ø£Ø´Ù‚Ø§Ø¡. ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ ÙŠØ´ØªØ±Ùƒ Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù….</p>
            </div>
            <div class="p-4 bg-cyan-50 rounded-xl border border-cyan-200">
              <h4 class="font-bold text-cyan-800 mb-2">Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©</h4>
              <p class="text-sm text-cyan-700">Ø²ÙˆØ¬ + Ø£Ù… + Ø¬Ø¯ + Ø£Ø®Øª Ø´Ù‚ÙŠÙ‚Ø©. ØªÙØ¬Ù…Ø¹ ÙˆØªÙÙ‚Ø³Ù… Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø®Ø§ØµØ©.</p>
            </div>
            <div class="p-4 bg-rose-50 rounded-xl border border-rose-200">
              <h4 class="font-bold text-rose-800 mb-2">Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±</h4>
              <p class="text-sm text-rose-700">Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø£Ùˆ Ù„Ø£Ø¨ Ù…Ø¹ Ø§Ù„Ø¨Ù†Øª Ø£Ùˆ Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† ØªØµØ¨Ø­ Ø¹ØµØ¨Ø©.</p>
            </div>
          </div>
        </div>
        
        <!-- Fard Table -->
        <div class="mb-8">
          <h3 class="text-xl font-bold mb-4">ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ±ÙˆØ¶ Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-3 text-right">Ø§Ù„ÙØ±Ø¶</th>
                  <th class="p-3 text-right">Ø£ØµØ­Ø§Ø¨Ù‡</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b"><td class="p-3 font-bold">Ø§Ù„Ù†ØµÙ (Â½)</td><td class="p-3">Ø§Ù„Ø¨Ù†Øª Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŒ Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŒ Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŒ Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŒ Ø§Ù„Ø²ÙˆØ¬ Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹</td></tr>
                <tr class="border-b"><td class="p-3 font-bold">Ø§Ù„Ø±Ø¨Ø¹ (Â¼)</td><td class="p-3">Ø§Ù„Ø²ÙˆØ¬ Ù…Ø¹ Ø§Ù„ÙØ±Ø¹ØŒ Ø§Ù„Ø²ÙˆØ¬Ø© Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹</td></tr>
                <tr class="border-b"><td class="p-3 font-bold">Ø§Ù„Ø«Ù…Ù† (â…›)</td><td class="p-3">Ø§Ù„Ø²ÙˆØ¬Ø© Ù…Ø¹ Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«</td></tr>
                <tr class="border-b"><td class="p-3 font-bold">Ø§Ù„Ø«Ù„Ø«Ø§Ù† (â…”)</td><td class="p-3">Ø§Ù„Ø¨Ù†ØªØ§Ù† ÙØ£ÙƒØ«Ø±ØŒ Ø¨Ù†ØªØ§ Ø§Ù„Ø§Ø¨Ù† ÙØ£ÙƒØ«Ø±ØŒ Ø§Ù„Ø£Ø®ØªØ§Ù† Ø§Ù„Ø´Ù‚ÙŠÙ‚ØªØ§Ù† ÙØ£ÙƒØ«Ø±ØŒ Ø§Ù„Ø£Ø®ØªØ§Ù† Ù„Ø£Ø¨ ÙØ£ÙƒØ«Ø±</td></tr>
                <tr class="border-b"><td class="p-3 font-bold">Ø§Ù„Ø«Ù„Ø« (â…“)</td><td class="p-3">Ø§Ù„Ø£Ù… Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹ ÙˆØ¬Ù…Ø¹ Ø¥Ø®ÙˆØ©ØŒ Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… (2 ÙØ£ÙƒØ«Ø±)</td></tr>
                <tr class="border-b"><td class="p-3 font-bold">Ø§Ù„Ø³Ø¯Ø³ (â…™)</td><td class="p-3">Ø§Ù„Ø£Ø¨ Ù…Ø¹ Ø§Ù„ÙØ±Ø¹ØŒ Ø§Ù„Ø£Ù… Ù…Ø¹ Ø§Ù„ÙØ±Ø¹ Ø£Ùˆ Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ©ØŒ Ø§Ù„Ø¬Ø¯ØŒ Ø§Ù„Ø¬Ø¯Ø©ØŒ Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† ØªÙƒÙ…Ù„Ø©ØŒ Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ ØªÙƒÙ…Ù„Ø©ØŒ Ø§Ù„Ø£Ø® Ù„Ø£Ù… Ø§Ù„ÙˆØ§Ø­Ø¯</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Hijab Rules -->
        <div>
          <h3 class="text-xl font-bold mb-4">ğŸš« Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø­Ø¬Ø¨</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-3 text-right">Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨</th>
                  <th class="p-3 text-right">Ø§Ù„Ø­Ø§Ø¬Ø¨</th>
                  <th class="p-3 text-right">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø¨</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø¬Ø¯</td><td class="p-3">Ø§Ù„Ø£Ø¨</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨</td><td class="p-3">Ø§Ù„Ø£Ù… Ø£Ùˆ Ø§Ù„Ø£Ø¨</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù…</td><td class="p-3">Ø§Ù„Ø£Ù…</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†</td><td class="p-3">Ø§Ù„Ø§Ø¨Ù†</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†</td><td class="p-3">Ø§Ù„Ø§Ø¨Ù†ØŒ Ø£Ùˆ Ø¨Ù†ØªØ§Ù† Ø¨Ø¯ÙˆÙ† Ù…Ø¹ØµØ¨</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡</td><td class="p-3">Ø§Ù„Ø§Ø¨Ù†ØŒ Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†ØŒ Ø§Ù„Ø£Ø¨</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ø¨</td><td class="p-3">Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚ØŒ Ø£Ùˆ Ù…Ù† ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…</td><td class="p-3">Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«ØŒ Ø§Ù„Ø£Ø¨ØŒ Ø§Ù„Ø¬Ø¯</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
                <tr class="border-b"><td class="p-3">Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨</td><td class="p-3">Ø£Ø®ØªØ§Ù† Ø´Ù‚ÙŠÙ‚ØªØ§Ù† Ø¨Ø¯ÙˆÙ† Ù…Ø¹ØµØ¨</td><td class="p-3">Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== Audit Tab ==================== -->
    <div id="tab-audit" class="tab-content hidden">
      <div class="card p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <span>ğŸ“‹</span> Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚
        </h2>
        
        <div class="flex flex-wrap gap-4 mb-6">
          <button id="clearAuditBtn" class="btn-danger text-white px-4 py-2 rounded-lg">
            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
          </button>
          <button id="exportAuditBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
            ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„
          </button>
          <button id="refreshAuditBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
            ğŸ”„ ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        
        <div class="audit-log" id="auditLogContainer">
          <div class="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯...</div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-8 text-center text-gray-500 text-sm no-print">
      <p class="mb-2">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø±ÙŠØ« Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© â€” Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0</p>
      <p class="text-xs">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„Ø§Ø³ØªØ±Ø´Ø§Ø¯ ÙÙ‚Ø· â€” ÙŠÙØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ø§Ù„Ù… Ù…ØªØ®ØµØµ Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©</p>
      <p class="text-xs mt-1">ØªØ·ÙˆÙŠØ± Ø£Ø¨Ùˆ Ø­Ø³Ù† Ø§Ù„Ù†Ø³ÙŠ - Ø®Ø§Ù„Øµ Ù„ÙˆØ¬Ù‡ Ø§Ù„Ù„Ù‡</p>
    </footer>
  </div>

<script>
// ============================================================================
// Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø±ÙŠØ« â€” Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0
// Ù…ÙØµØ­ÙÙ‘Ø­ ÙˆÙ…ÙØ­Ø³ÙÙ‘Ù† - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ÙƒØªØ´ÙØ© ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡Ø§
// ============================================================================

'use strict';

// ==================== 1. Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ù…ÙØ­Ø³ÙÙ‘Ù† ====================
class Fraction {
  constructor(numerator, denominator = 1) {
    if (typeof numerator !== 'number' || typeof denominator !== 'number') {
      throw new Error('Ø§Ù„Ø¨Ø³Ø· ÙˆØ§Ù„Ù…Ù‚Ø§Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ†Ø§ Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹');
    }
    if (denominator === 0) {
      throw new Error('Ø§Ù„Ù…Ù‚Ø§Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ØµÙØ±Ø§Ù‹');
    }
    if (!Number.isFinite(numerator) || !Number.isFinite(denominator)) {
      throw new Error('Ø§Ù„Ù‚ÙŠÙ… ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ Ù…Ù†ØªÙ‡ÙŠØ©');
    }
    
    // Ø§Ù„ØªØ·Ø¨ÙŠØ¹: Ø¬Ø¹Ù„ Ø§Ù„Ù…Ù‚Ø§Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…ÙˆØ¬Ø¨Ø§Ù‹
    const sign = denominator < 0 ? -1 : 1;
    numerator = Math.round(numerator * sign);
    denominator = Math.abs(Math.round(denominator));
    
    const g = Fraction.gcd(Math.abs(numerator), denominator);
    this.num = numerator / g;
    this.den = denominator / g;
    
    // Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØªØ¶Ø®Ù…
    if (Math.abs(this.num) > 1e12 || this.den > 1e12) {
      // ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù…Ø¹Ù‚ÙˆÙ„Ø©
      const decimal = this.num / this.den;
      this.num = Math.round(decimal * 1e9);
      this.den = 1e9;
      const g2 = Fraction.gcd(Math.abs(this.num), this.den);
      this.num /= g2;
      this.den /= g2;
    }
  }
  
  static gcd(a, b) {
    a = Math.abs(Math.round(a));
    b = Math.abs(Math.round(b));
    while (b > 0) {
      [a, b] = [b, a % b];
    }
    return a || 1;
  }
  
  static lcm(a, b) {
    a = Math.abs(Math.round(a));
    b = Math.abs(Math.round(b));
    if (a === 0 || b === 0) return 0;
    return (a * b) / Fraction.gcd(a, b);
  }
  
  static lcmArray(arr) {
    if (!arr || arr.length === 0) return 1;
    const filtered = arr.filter(n => n > 0);
    if (filtered.length === 0) return 1;
    return filtered.reduce((a, b) => Fraction.lcm(a, b), filtered[0]);
  }
  
  static fromDecimal(decimal, maxDenominator = 10000) {
    if (decimal === 0) return new Fraction(0);
    
    const sign = decimal < 0 ? -1 : 1;
    decimal = Math.abs(decimal);
    
    let bestNum = 1, bestDen = 1;
    let minError = Math.abs(decimal - 1);
    
    for (let den = 1; den <= maxDenominator; den++) {
      const num = Math.round(decimal * den);
      const error = Math.abs(decimal - num / den);
      if (error < minError) {
        minError = error;
        bestNum = num;
        bestDen = den;
        if (error < 1e-10) break;
      }
    }
    
    return new Fraction(sign * bestNum, bestDen);
  }
  
  add(other) {
    if (!(other instanceof Fraction)) other = new Fraction(other);
    return new Fraction(
      this.num * other.den + other.num * this.den,
      this.den * other.den
    );
  }
  
  subtract(other) {
    if (!(other instanceof Fraction)) other = new Fraction(other);
    return new Fraction(
      this.num * other.den - other.num * this.den,
      this.den * other.den
    );
  }
  
  multiply(other) {
    if (!(other instanceof Fraction)) other = new Fraction(other);
    return new Fraction(this.num * other.num, this.den * other.den);
  }
  
  divide(other) {
    if (!(other instanceof Fraction)) other = new Fraction(other);
    if (other.num === 0) throw new Error('Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ØµÙØ±');
    return new Fraction(this.num * other.den, this.den * other.num);
  }
  
  toDecimal() { 
    return this.num / this.den; 
  }
  
  toString() {
    if (this.num === 0) return '0';
    if (this.den === 1) return String(this.num);
    return `${this.num}/${this.den}`;
  }
  
  toArabic() {
    const toArabicNum = n => String(Math.abs(n)).replace(/\d/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);
    
    if (this.num === 0) return 'Ù ';
    const sign = this.num < 0 ? '-' : '';
    if (this.den === 1) return sign + toArabicNum(this.num);
    
    // Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø§Ù„Ù…ÙŠØ±Ø§Ø«
    const common = {
      '1/2': 'Â½', '1/3': 'â…“', '2/3': 'â…”', '1/4': 'Â¼', '3/4': 'Â¾',
      '1/6': 'â…™', '5/6': 'â…š', '1/8': 'â…›', '3/8': 'â…œ', '5/8': 'â…', '7/8': 'â…',
      '1/12': 'Â¹â„â‚â‚‚', '5/12': 'âµâ„â‚â‚‚', '7/12': 'â·â„â‚â‚‚', '11/12': 'Â¹Â¹â„â‚â‚‚'
    };
    
    const key = `${Math.abs(this.num)}/${this.den}`;
    if (common[key]) return sign + common[key];
    
    return sign + toArabicNum(Math.abs(this.num)) + '/' + toArabicNum(this.den);
  }
  
  isZero() { return this.num === 0; }
  isPositive() { return this.num > 0; }
  isNegative() { return this.num < 0; }
  
  equals(other) {
    if (!(other instanceof Fraction)) other = new Fraction(other);
    return this.num === other.num && this.den === other.den;
  }
  
  compareTo(other) {
    if (!(other instanceof Fraction)) other = new Fraction(other);
    return this.num * other.den - other.num * this.den;
  }
  
  lessThan(other) { return this.compareTo(other) < 0; }
  greaterThan(other) { return this.compareTo(other) > 0; }
  lessThanOrEqual(other) { return this.compareTo(other) <= 0; }
  greaterThanOrEqual(other) { return this.compareTo(other) >= 0; }
  
  clone() { return new Fraction(this.num, this.den); }
  
  static ZERO = new Fraction(0);
  static ONE = new Fraction(1);
  static HALF = new Fraction(1, 2);
  static THIRD = new Fraction(1, 3);
  static QUARTER = new Fraction(1, 4);
  static SIXTH = new Fraction(1, 6);
  static EIGHTH = new Fraction(1, 8);
  static TWO_THIRDS = new Fraction(2, 3);
}

// ==================== 2. Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ‚Ù‡ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© ====================
const FIQH_DATABASE = {
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨
  madhabs: {
    shafii: {
      id: 'shafii',
      name: 'Ø§Ù„Ø´Ø§ÙØ¹ÙŠ',
      icon: 'ğŸŸ¢',
      description: 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø¹Ø¯Ø§ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†. Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø·Ù„Ù‚Ø§Ù‹. Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø¹ØªØ¨Ø±Ø©.',
      rules: {
        grandfatherWithSiblings: 'blocks', // Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ©
        raddToSpouse: false,
        bloodRelativesEnabled: true,
        musharrakaEnabled: true, // Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
        akdariyyaEnabled: true
      }
    },
    hanafi: {
      id: 'hanafi',
      name: 'Ø§Ù„Ø­Ù†ÙÙŠ',
      icon: 'ğŸ”´',
      description: 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ† Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØºÙŠØ±Ù‡Ù…. Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ©. Ù„Ø§ Ù…Ø´ØªØ±ÙƒØ©.',
      rules: {
        grandfatherWithSiblings: 'blocks',
        raddToSpouse: true, // ÙŠÙØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†
        bloodRelativesEnabled: true,
        musharrakaEnabled: false, // Ù„Ø§ Ù…Ø´ØªØ±ÙƒØ©
        akdariyyaEnabled: true
      }
    },
    maliki: {
      id: 'maliki',
      name: 'Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ',
      icon: 'ğŸŸ£',
      description: 'Ø§Ù„Ø¬Ø¯ ÙŠÙÙ‚Ø§Ø³Ù… Ø§Ù„Ø¥Ø®ÙˆØ©. Ù„Ø§ Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†. Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„. Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø¹ØªØ¨Ø±Ø©.',
      rules: {
        grandfatherWithSiblings: 'shares', // ÙŠÙÙ‚Ø§Ø³Ù…
        raddToSpouse: false,
        bloodRelativesEnabled: false, // Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„
        musharrakaEnabled: true,
        akdariyyaEnabled: true
      }
    },
    hanbali: {
      id: 'hanbali',
      name: 'Ø§Ù„Ø­Ù†Ø¨Ù„ÙŠ',
      icon: 'ğŸ”µ',
      description: 'Ø§Ù„Ø¬Ø¯ ÙŠÙÙ‚Ø§Ø³Ù… Ø§Ù„Ø¥Ø®ÙˆØ©. ÙŠÙØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©. Ù„Ø§ Ù…Ø´ØªØ±ÙƒØ©.',
      rules: {
        grandfatherWithSiblings: 'shares',
        raddToSpouse: true,
        bloodRelativesEnabled: true,
        musharrakaEnabled: false,
        akdariyyaEnabled: true
      }
    }
  },
  
  // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙˆØ±Ø«Ø©
  heirNames: {
    husband: 'Ø§Ù„Ø²ÙˆØ¬',
    wife: 'Ø§Ù„Ø²ÙˆØ¬Ø©',
    wives: 'Ø§Ù„Ø²ÙˆØ¬Ø§Øª',
    father: 'Ø§Ù„Ø£Ø¨',
    mother: 'Ø§Ù„Ø£Ù…',
    grandfather: 'Ø§Ù„Ø¬Ø¯',
    grandmother: 'Ø§Ù„Ø¬Ø¯Ø©',
    grandmother_mother: 'Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù…',
    grandmother_father: 'Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨',
    grandmothers: 'Ø§Ù„Ø¬Ø¯Ø§Øª',
    son: 'Ø§Ù„Ø§Ø¨Ù†',
    sons: 'Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡',
    daughter: 'Ø§Ù„Ø¨Ù†Øª',
    daughters: 'Ø§Ù„Ø¨Ù†Ø§Øª',
    grandson: 'Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†',
    grandsons: 'Ø£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø¨Ù†',
    granddaughter: 'Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†',
    granddaughters: 'Ø¨Ù†Ø§Øª Ø§Ù„Ø§Ø¨Ù†',
    full_brother: 'Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚',
    full_brothers: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡',
    full_sister: 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©',
    full_sisters: 'Ø§Ù„Ø£Ø®ÙˆØ§Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø§Øª',
    paternal_brother: 'Ø§Ù„Ø£Ø® Ù„Ø£Ø¨',
    paternal_brothers: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ø¨',
    paternal_sister: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨',
    paternal_sisters: 'Ø§Ù„Ø£Ø®ÙˆØ§Øª Ù„Ø£Ø¨',
    maternal_brother: 'Ø§Ù„Ø£Ø® Ù„Ø£Ù…',
    maternal_sister: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ù…',
    maternal_siblings: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…',
    full_nephew: 'Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚',
    paternal_nephew: 'Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ù„Ø£Ø¨',
    full_uncle: 'Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚',
    paternal_uncle: 'Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨',
    full_cousin: 'Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚',
    paternal_cousin: 'Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨',
    maternal_uncle: 'Ø§Ù„Ø®Ø§Ù„',
    maternal_aunt: 'Ø§Ù„Ø®Ø§Ù„Ø©',
    paternal_aunt: 'Ø§Ù„Ø¹Ù…Ø©',
    daughter_son: 'Ø§Ø¨Ù† Ø§Ù„Ø¨Ù†Øª',
    daughter_daughter: 'Ø¨Ù†Øª Ø§Ù„Ø¨Ù†Øª',
    sister_children: 'Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø£Ø®Øª',
    treasury: 'Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„'
  },
  
  // ØªØ±ØªÙŠØ¨ Ø°ÙˆÙŠ Ø§Ù„Ø£Ø±Ø­Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù
  bloodRelativesOrder: [
    { key: 'daughter_son', class: 1, name: 'Ø§Ø¨Ù† Ø§Ù„Ø¨Ù†Øª' },
    { key: 'daughter_daughter', class: 1, name: 'Ø¨Ù†Øª Ø§Ù„Ø¨Ù†Øª' },
    { key: 'sister_children', class: 2, name: 'Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø£Ø®Øª' },
    { key: 'maternal_uncle', class: 3, name: 'Ø§Ù„Ø®Ø§Ù„' },
    { key: 'maternal_aunt', class: 3, name: 'Ø§Ù„Ø®Ø§Ù„Ø©' },
    { key: 'paternal_aunt', class: 4, name: 'Ø§Ù„Ø¹Ù…Ø©' }
  ]
};

// ==================== 3. ÙØ¦Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙˆØ§Ø±Ø« ====================
class HeirShare {
  constructor(options) {
    this.key = options.key;
    this.name = options.name || FIQH_DATABASE.heirNames[options.key] || options.key;
    this.type = options.type || 'ÙØ±Ø¶'; // ÙØ±Ø¶ØŒ Ø¹ØµØ¨Ø©ØŒ ÙØ±Ø¶ + ØªØ¹ØµÙŠØ¨ØŒ Ø±Ø¯ØŒ Ø°Ùˆ Ø±Ø­Ù…
    this.count = options.count || 1;
    this.fraction = options.fraction instanceof Fraction ? options.fraction : new Fraction(0);
    this.originalFraction = this.fraction.clone();
    this.reason = options.reason || '';
    this.blocked = options.blocked || false;
    this.blockedBy = options.blockedBy || null;
    this.amount = 0;
    this.amountPerPerson = 0;
  }
  
  setFraction(fraction) {
    this.fraction = fraction instanceof Fraction ? fraction : new Fraction(fraction);
  }
  
  addFraction(fraction) {
    this.fraction = this.fraction.add(fraction);
  }
  
  calculateAmount(netEstate) {
    this.amount = netEstate * this.fraction.toDecimal();
    this.amountPerPerson = this.amount / this.count;
  }
  
  getPerPerson() {
    if (this.count <= 0) return new Fraction(0);
    return new Fraction(this.fraction.num, this.fraction.den * this.count);
  }
}

// ==================== 4. Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ ====================
class InheritanceEngine {
  constructor(madhab, estate, heirs) {
    this.madhab = madhab;
    this.config = FIQH_DATABASE.madhabs[madhab];
    
    if (!this.config) {
      throw new Error(`Ø§Ù„Ù…Ø°Ù‡Ø¨ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ: ${madhab}`);
    }
    
    this.estate = this.validateEstate(estate);
    this.heirs = this.normalizeHeirs(heirs);
    
    // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ
    this.state = {
      steps: [],
      specialCases: [],
      blockedHeirs: [],
      madhhabNotes: [],
      warnings: [],
      errors: []
    };
    
    // Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    this.results = {
      netEstate: 0,
      shares: [],
      asl: 1,
      finalBase: 1,
      awlRatio: null,
      awlApplied: false,
      raddApplied: false,
      bloodRelativesApplied: false,
      confidence: 1.0
    };
  }
  
  // ========== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªØ±ÙƒØ© ==========
  validateEstate(estate) {
    const total = Math.max(0, parseFloat(estate.total) || 0);
    
    if (total <= 0) {
      this.state.errors.push('Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ±ÙƒØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±');
    }
    
    const funeral = Math.max(0, Math.min(parseFloat(estate.funeral) || 0, total));
    const debts = Math.max(0, Math.min(parseFloat(estate.debts) || 0, total - funeral));
    const remaining = total - funeral - debts;
    const maxWill = remaining / 3;
    let will = Math.max(0, parseFloat(estate.will) || 0);
    
    if (will > maxWill && remaining > 0) {
      this.state.warnings.push(
        `Ø§Ù„ÙˆØµÙŠØ© (${will.toLocaleString()}) ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø«Ù„Ø«. ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ ${maxWill.toLocaleString()}`
      );
      will = maxWill;
    }
    
    return { total, funeral, debts, will };
  }
  
  // ========== ØªØ·Ø¨ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø© ==========
  normalizeHeirs(heirs) {
    const normalized = {};
    
    // Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø¹Ù„Ù‰ ÙƒÙ„ ÙˆØ§Ø±Ø«
    const constraints = {
      husband: { max: 1 },
      wife: { max: 4 },
      father: { max: 1 },
      mother: { max: 1 },
      grandfather: { max: 1 },
      grandmother_mother: { max: 1 },
      grandmother_father: { max: 1 }
    };
    
    for (const [key, value] of Object.entries(heirs)) {
      let val = Math.max(0, Math.floor(parseInt(value) || 0));
      
      if (constraints[key]?.max) {
        val = Math.min(val, constraints[key].max);
      }
      
      normalized[key] = val;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª
    if (normalized.husband > 0 && normalized.wife > 0) {
      this.state.errors.push('Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙˆØ¬ÙˆØ¯ Ø²ÙˆØ¬ ÙˆØ²ÙˆØ¬Ø© Ù…Ø¹Ø§Ù‹ Ù„Ù„Ù…ÙŠØª Ø§Ù„ÙˆØ§Ø­Ø¯');
      normalized.wife = 0;
    }
    
    return normalized;
  }
  
  // ========== Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ© ==========
  addStep(title, description, details = null) {
    this.state.steps.push({ 
      title, 
      description, 
      details, 
      timestamp: Date.now() 
    });
  }
  
  // ========== ÙØ­ÙˆØµØ§Øª Ø§Ù„ÙˆØ¬ÙˆØ¯ ==========
  hasDescendants() {
    const h = this.heirs;
    return (h.son || 0) + (h.daughter || 0) + (h.grandson || 0) + (h.granddaughter || 0) > 0;
  }
  
  hasMaleDescendants() {
    return (this.heirs.son || 0) + (this.heirs.grandson || 0) > 0;
  }
  
  hasFemaleDescendants() {
    return (this.heirs.daughter || 0) + (this.heirs.granddaughter || 0) > 0;
  }
  
  hasChildren() {
    return (this.heirs.son || 0) + (this.heirs.daughter || 0) > 0;
  }
  
  hasSons() {
    return (this.heirs.son || 0) > 0;
  }
  
  getFullSiblingsCount() {
    return (this.heirs.full_brother || 0) + (this.heirs.full_sister || 0);
  }
  
  getPaternalSiblingsCount() {
    return (this.heirs.paternal_brother || 0) + (this.heirs.paternal_sister || 0);
  }
  
  getMaternalSiblingsCount() {
    return (this.heirs.maternal_brother || 0) + (this.heirs.maternal_sister || 0);
  }
  
  getAllSiblingsCount() {
    return this.getFullSiblingsCount() + this.getPaternalSiblingsCount() + this.getMaternalSiblingsCount();
  }
  
  getFullAndPaternalSiblingsCount() {
    return this.getFullSiblingsCount() + this.getPaternalSiblingsCount();
  }
  
  hasMaleAscendant() {
    return (this.heirs.father || 0) > 0 || (this.heirs.grandfather || 0) > 0;
  }
  
  hasSpouse() {
    return (this.heirs.husband || 0) > 0 || (this.heirs.wife || 0) > 0;
  }
  
  // ========== Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ© ==========
  
  // Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø©: Ø²ÙˆØ¬/Ø²ÙˆØ¬Ø© + Ø£Ø¨ + Ø£Ù… ÙÙ‚Ø·
  isUmariyyah() {
    const h = this.heirs;
    const hasSpouse = (h.husband || 0) > 0 || (h.wife || 0) > 0;
    const hasFatherMother = (h.father || 0) > 0 && (h.mother || 0) > 0;
    const noDescendants = !this.hasDescendants();
    const noSiblings = this.getAllSiblingsCount() === 0;
    const noGrandfather = (h.grandfather || 0) === 0;
    
    return hasSpouse && hasFatherMother && noDescendants && noSiblings && noGrandfather;
  }
  
  // Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø§Ù„Ø­Ù…Ø§Ø±ÙŠØ©): Ø²ÙˆØ¬ + Ø£Ù…/Ø¬Ø¯Ø© + Ø¥Ø®ÙˆØ© Ù„Ø£Ù… (2+) + Ø¥Ø®ÙˆØ© Ø£Ø´Ù‚Ø§Ø¡
  isMusharraka() {
    if (!this.config.rules.musharrakaEnabled) return false;
    
    const h = this.heirs;
    const hasHusband = (h.husband || 0) > 0;
    const hasMotherOrGrandmother = (h.mother || 0) > 0 || (h.grandmother_mother || 0) > 0;
    const maternalSiblings = this.getMaternalSiblingsCount();
    const hasFullSiblings = this.getFullSiblingsCount() > 0;
    const noDescendants = !this.hasDescendants();
    const noFatherOrGrandfather = (h.father || 0) === 0 && (h.grandfather || 0) === 0;
    
    return hasHusband && hasMotherOrGrandmother && maternalSiblings >= 2 && 
           hasFullSiblings && noDescendants && noFatherOrGrandfather;
  }
  
  // Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©: Ø²ÙˆØ¬ + Ø£Ù… + Ø¬Ø¯ + Ø£Ø®Øª Ø´Ù‚ÙŠÙ‚Ø© (Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹ Ø£Ùˆ Ø£Ø¨)
  isAkdariyya() {
    const h = this.heirs;
    return (h.husband || 0) > 0 && 
           (h.mother || 0) > 0 && 
           (h.grandfather || 0) > 0 && 
           (h.full_sister || 0) > 0 &&
           !this.hasDescendants() &&
           (h.father || 0) === 0 &&
           (h.full_brother || 0) === 0;
  }
  
  // ========== Ø§Ù„Ø­Ø¬Ø¨ ==========
  applyHijab() {
    this.addStep('ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¬Ø¨', 'ÙØ­Øµ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø­Ø¬Ø¨ Ø§Ù„ÙÙ‚Ù‡ÙŠØ©');
    const blocked = [];
    const h = this.heirs;
    const rules = this.config.rules;
    
    // 1. Ø§Ù„Ø£Ø¨ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¬Ø¯
    if (h.father > 0 && h.grandfather > 0) {
      blocked.push({ 
        heir: 'grandfather', 
        by: 'father', 
        reason: 'Ø§Ù„Ø¬Ø¯ Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø£Ø¨ Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†' 
      });
      h.grandfather = 0;
    }
    
    // 2. Ø§Ù„Ø£Ù… ØªØ­Ø¬Ø¨ Ø§Ù„Ø¬Ø¯Ø§Øª
    if (h.mother > 0) {
      if (h.grandmother_mother > 0) {
        blocked.push({ 
          heir: 'grandmother_mother', 
          by: 'mother', 
          reason: 'Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù… Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø§Ù„Ø£Ù…' 
        });
        h.grandmother_mother = 0;
      }
      if (h.grandmother_father > 0) {
        blocked.push({ 
          heir: 'grandmother_father', 
          by: 'mother', 
          reason: 'Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø§Ù„Ø£Ù…' 
        });
        h.grandmother_father = 0;
      }
    }
    
    // 3. Ø§Ù„Ø£Ø¨ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨ (ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨)
    if (h.father > 0 && h.grandmother_father > 0) {
      blocked.push({ 
        heir: 'grandmother_father', 
        by: 'father', 
        reason: 'Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø§Ù„Ø£Ø¨' 
      });
      h.grandmother_father = 0;
    }
    
    // 4. Ø§Ù„Ø§Ø¨Ù† ÙŠØ­Ø¬Ø¨ Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù† ÙˆØ¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†
    if (h.son > 0) {
      if (h.grandson > 0) {
        blocked.push({ 
          heir: 'grandson', 
          by: 'son', 
          reason: 'Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù† Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø§Ø¨Ù† Ø§Ù„Ø£Ù‚Ø±Ø¨' 
        });
        h.grandson = 0;
      }
      if (h.granddaughter > 0) {
        blocked.push({ 
          heir: 'granddaughter', 
          by: 'son', 
          reason: 'Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø§Ù„Ø§Ø¨Ù†' 
        });
        h.granddaughter = 0;
      }
    }
    
    // 5. Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø¨Ù†ØªÙŠÙ† ÙØ£ÙƒØ«Ø± (Ø¥Ù„Ø§ Ù…Ø¹ Ø§Ø¨Ù† Ø§Ø¨Ù† Ù…Ø¹ØµØ¨)
    if (h.daughter >= 2 && h.granddaughter > 0 && (h.grandson || 0) === 0) {
      blocked.push({ 
        heir: 'granddaughter', 
        by: 'daughter', 
        reason: 'Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø¨Ù†ØªÙŠÙ† ÙØ£ÙƒØ«Ø± Ù„Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø«Ù„Ø«ÙŠÙ† ÙˆÙ„Ø§ Ù…Ø¹ØµØ¨ Ù„Ù‡Ø§' 
      });
      h.granddaughter = 0;
    }
    
    // 6. Ø­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© Ø¨Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø« Ø§Ù„Ø°ÙƒØ± Ø£Ùˆ Ø§Ù„Ø£Ø¨
    const blockedByMaleFuruOrFather = h.son > 0 || h.grandson > 0 || h.father > 0;
    
    if (blockedByMaleFuruOrFather) {
      const siblingsToBlock = ['full_brother', 'full_sister', 'paternal_brother', 'paternal_sister'];
      siblingsToBlock.forEach(heir => {
        if (h[heir] > 0) {
          const blocker = h.father > 0 ? 'Ø§Ù„Ø£Ø¨' : 'Ø§Ù„Ø§Ø¨Ù†/Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†';
          blocked.push({ 
            heir, 
            by: blocker, 
            reason: `${FIQH_DATABASE.heirNames[heir]} Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ù€${blocker}` 
          });
          h[heir] = 0;
        }
      });
    }
    
    // 7. Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© ÙÙŠ Ø§Ù„Ø´Ø§ÙØ¹ÙŠ ÙˆØ§Ù„Ø­Ù†ÙÙŠ
    if (h.grandfather > 0 && rules.grandfatherWithSiblings === 'blocks') {
      const siblingsToBlock = ['full_brother', 'full_sister', 'paternal_brother', 'paternal_sister'];
      siblingsToBlock.forEach(heir => {
        if (h[heir] > 0) {
          blocked.push({ 
            heir, 
            by: 'grandfather', 
            reason: `${FIQH_DATABASE.heirNames[heir]} Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø¬Ø¯ (${this.config.name})` 
          });
          h[heir] = 0;
        }
      });
      this.state.madhhabNotes.push(`ÙÙŠ Ø§Ù„Ù…Ø°Ù‡Ø¨ ${this.config.name}: Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙˆÙ„Ø£Ø¨ Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†`);
    }
    
    // 8. Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ† Ø¨Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø« Ù…Ø·Ù„Ù‚Ø§Ù‹ Ø£Ùˆ Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ø°ÙƒØ±
    if (this.hasDescendants() || this.hasMaleAscendant()) {
      ['maternal_brother', 'maternal_sister'].forEach(heir => {
        if (h[heir] > 0) {
          const blocker = this.hasDescendants() ? 'Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«' : 'Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ø°ÙƒØ±';
          blocked.push({ 
            heir, 
            by: blocker, 
            reason: `${FIQH_DATABASE.heirNames[heir]} Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ù€${blocker}` 
          });
          h[heir] = 0;
        }
      });
    }
    
    // 9. Ø§Ù„Ø£Ø® Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚
    if (h.full_brother > 0 && h.paternal_brother > 0) {
      blocked.push({ 
        heir: 'paternal_brother', 
        by: 'full_brother', 
        reason: 'Ø§Ù„Ø£Ø® Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚ Ù„Ù‚ÙˆØ© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø©' 
      });
      h.paternal_brother = 0;
    }
    
    // 10. Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© ØªØ­Ø¬Ø¨ Ø§Ù„Ø£Ø® Ù„Ø£Ø¨ Ø¥Ø°Ø§ ØµØ§Ø±Øª Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±
    // (ØªÙØ¹Ø§Ù„Ø¬ Ù„Ø§Ø­Ù‚Ø§Ù‹ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª)
    
    // 11. Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø£Ø®ØªÙŠÙ† Ø´Ù‚ÙŠÙ‚ØªÙŠÙ† (Ø¥Ù„Ø§ Ù…Ø¹ Ø£Ø® Ù„Ø£Ø¨ Ù…Ø¹ØµØ¨)
    if (h.full_sister >= 2 && h.paternal_sister > 0 && (h.paternal_brother || 0) === 0) {
      // Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±
      if (!this.hasFemaleDescendants()) {
        blocked.push({ 
          heir: 'paternal_sister', 
          by: 'full_sister', 
          reason: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨Ø© Ø¨Ø£Ø®ØªÙŠÙ† Ø´Ù‚ÙŠÙ‚ØªÙŠÙ† ÙØ£ÙƒØ«Ø± Ù„Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø«Ù„Ø«ÙŠÙ† ÙˆÙ„Ø§ Ù…Ø¹ØµØ¨ Ù„Ù‡Ø§' 
        });
        h.paternal_sister = 0;
      }
    }
    
    // 12. Ø­Ø¬Ø¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© Ø¨Ø§Ù„Ø£Ù‚Ø±Ø¨
    const hasCloserAsaba = h.full_brother > 0 || h.paternal_brother > 0 ||
                           (h.grandfather > 0 && rules.grandfatherWithSiblings === 'shares');
    
    if (hasCloserAsaba || h.father > 0 || this.hasMaleDescendants()) {
      const distantAsaba = ['full_nephew', 'paternal_nephew', 'full_uncle', 'paternal_uncle', 'full_cousin', 'paternal_cousin'];
      distantAsaba.forEach(heir => {
        if (h[heir] > 0) {
          blocked.push({ 
            heir, 
            by: 'Ø¹Ø§ØµØ¨ Ø£Ù‚Ø±Ø¨', 
            reason: `${FIQH_DATABASE.heirNames[heir]} Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø¹Ø§ØµØ¨ Ø£Ù‚Ø±Ø¨ Ù…Ù†Ù‡` 
          });
          h[heir] = 0;
        }
      });
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© ÙÙŠÙ…Ø§ Ø¨ÙŠÙ†Ù‡Ø§
    if (h.full_nephew > 0) {
      ['paternal_nephew', 'full_uncle', 'paternal_uncle', 'full_cousin', 'paternal_cousin'].forEach(heir => {
        if (h[heir] > 0) {
          blocked.push({ heir, by: 'full_nephew', reason: `Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚` });
          h[heir] = 0;
        }
      });
    } else if (h.paternal_nephew > 0) {
      ['full_uncle', 'paternal_uncle', 'full_cousin', 'paternal_cousin'].forEach(heir => {
        if (h[heir] > 0) {
          blocked.push({ heir, by: 'paternal_nephew', reason: `Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ù„Ø£Ø¨` });
          h[heir] = 0;
        }
      });
    } else if (h.full_uncle > 0) {
      ['paternal_uncle', 'full_cousin', 'paternal_cousin'].forEach(heir => {
        if (h[heir] > 0) {
          blocked.push({ heir, by: 'full_uncle', reason: `Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚` });
          h[heir] = 0;
        }
      });
    } else if (h.paternal_uncle > 0) {
      ['full_cousin', 'paternal_cousin'].forEach(heir => {
        if (h[heir] > 0) {
          blocked.push({ heir, by: 'paternal_uncle', reason: `Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨` });
          h[heir] = 0;
        }
      });
    } else if (h.full_cousin > 0) {
      if (h.paternal_cousin > 0) {
        blocked.push({ heir: 'paternal_cousin', by: 'full_cousin', reason: `Ù…Ø­Ø¬ÙˆØ¨ Ø¨Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚` });
        h.paternal_cousin = 0;
      }
    }
    
    this.state.blockedHeirs = blocked;
    
    if (blocked.length > 0) {
      this.addStep('Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø¬Ø¨', `ØªÙ… Ø­Ø¬Ø¨ ${blocked.length} ÙˆØ§Ø±Ø«/ÙˆØ±Ø«Ø©`, blocked);
    } else {
      this.addStep('Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø¬Ø¨', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ±Ø«Ø© Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ†');
    }
  }
  
  // ========== Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ ==========
  computeFixedShares() {
    this.addStep('Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶', 'ØªØ­Ø¯ÙŠØ¯ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ ÙˆÙØ±ÙˆØ¶Ù‡Ù…');
    const shares = [];
    const h = this.heirs;
    const hasDesc = this.hasDescendants();
    
    // ===== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø£ÙˆÙ„Ø§Ù‹ =====
    
    // 1. Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø§Ù„Ø­Ù…Ø§Ø±ÙŠØ©)
    if (this.isMusharraka()) {
      return this.computeMusharraka();
    }
    
    // 2. Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©
    if (this.isAkdariyya()) {
      return this.computeAkdariyya();
    }
    
    // 3. Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø©
    const isUmariyyah = this.isUmariyyah();
    if (isUmariyyah) {
      this.state.specialCases.push({ 
        type: 'umariyyah', 
        name: 'Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø©', 
        description: 'Ø§Ù„Ø£Ù… ØªØ£Ø®Ø° Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø¹Ø¯ Ù†ØµÙŠØ¨ Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø©ØŒ ÙˆØ§Ù„Ø£Ø¨ ÙŠØ£Ø®Ø° Ø§Ù„Ø¨Ø§Ù‚ÙŠ' 
      });
    }
    
    // ===== Ø§Ù„Ø²ÙˆØ¬ =====
    if (h.husband > 0) {
      const frac = hasDesc ? Fraction.QUARTER : Fraction.HALF;
      shares.push(new HeirShare({
        key: 'husband',
        name: 'Ø§Ù„Ø²ÙˆØ¬',
        type: 'ÙØ±Ø¶',
        fraction: frac,
        count: 1,
        reason: hasDesc ? 'Â¼ Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«' : 'Â½ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙØ±Ø¹ ÙˆØ§Ø±Ø«'
      }));
    }
    
    // ===== Ø§Ù„Ø²ÙˆØ¬Ø©/Ø§Ù„Ø²ÙˆØ¬Ø§Øª =====
    if (h.wife > 0) {
      const frac = hasDesc ? Fraction.EIGHTH : Fraction.QUARTER;
      shares.push(new HeirShare({
        key: 'wife',
        name: h.wife > 1 ? 'Ø§Ù„Ø²ÙˆØ¬Ø§Øª' : 'Ø§Ù„Ø²ÙˆØ¬Ø©',
        type: 'ÙØ±Ø¶',
        fraction: frac,
        count: h.wife,
        reason: hasDesc ? 
          `â…› ÙŠØ´ØªØ±ÙƒÙ† ÙÙŠÙ‡ Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«` : 
          `Â¼ ÙŠØ´ØªØ±ÙƒÙ† ÙÙŠÙ‡ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙØ±Ø¹ ÙˆØ§Ø±Ø«`
      }));
    }
    
    // ===== Ø§Ù„Ø£Ù… =====
    if (h.mother > 0) {
      let frac, reason;
      
      if (isUmariyyah) {
        // ÙÙŠ Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø©: Ø§Ù„Ø£Ù… ØªØ£Ø®Ø° Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ
        if (h.husband > 0) {
          // Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø²ÙˆØ¬ + Ø£Ø¨ + Ø£Ù…
          // Ø§Ù„Ø²ÙˆØ¬: 1/2ØŒ Ø§Ù„Ø£Ù…: 1/3 Ã— 1/2 = 1/6ØŒ Ø§Ù„Ø£Ø¨: Ø§Ù„Ø¨Ø§Ù‚ÙŠ = 2/6 = 1/3
          frac = Fraction.SIXTH;
          reason = 'Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø¹Ø¯ Ù†ØµÙŠØ¨ Ø§Ù„Ø²ÙˆØ¬ (Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)';
        } else {
          // Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø²ÙˆØ¬Ø© + Ø£Ø¨ + Ø£Ù…
          // Ø§Ù„Ø²ÙˆØ¬Ø©: 1/4ØŒ Ø§Ù„Ø¨Ø§Ù‚ÙŠ: 3/4ØŒ Ø§Ù„Ø£Ù…: 1/3 Ã— 3/4 = 1/4ØŒ Ø§Ù„Ø£Ø¨: Ø§Ù„Ø¨Ø§Ù‚ÙŠ = 2/4 = 1/2
          frac = Fraction.QUARTER;
          reason = 'Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø¹Ø¯ Ù†ØµÙŠØ¨ Ø§Ù„Ø²ÙˆØ¬Ø© (Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©)';
        }
      } else if (hasDesc) {
        frac = Fraction.SIXTH;
        reason = 'â…™ Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«';
      } else if (this.getAllSiblingsCount() >= 2) {
        frac = Fraction.SIXTH;
        reason = 'â…™ Ù„ÙˆØ¬ÙˆØ¯ Ø¬Ù…Ø¹ Ù…Ù† Ø§Ù„Ø¥Ø®ÙˆØ© (Ø§Ø«Ù†ÙŠÙ† ÙØ£ÙƒØ«Ø±)';
      } else {
        frac = Fraction.THIRD;
        reason = 'â…“ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙØ±Ø¹ ÙˆØ§Ø±Ø« ÙˆÙ„Ø§ Ø¬Ù…Ø¹ Ù…Ù† Ø§Ù„Ø¥Ø®ÙˆØ©';
      }
      
      shares.push(new HeirShare({
        key: 'mother',
        name: 'Ø§Ù„Ø£Ù…',
        type: 'ÙØ±Ø¶',
        fraction: frac,
        count: 1,
        reason
      }));
    }
    
    // ===== Ø§Ù„Ø£Ø¨ =====
    if (h.father > 0) {
      if (this.hasMaleDescendants()) {
        // Ù…Ø¹ Ø§Ø¨Ù† Ø£Ùˆ Ø§Ø¨Ù† Ø§Ø¨Ù†: Ø§Ù„Ø³Ø¯Ø³ ÙÙ‚Ø·
        shares.push(new HeirShare({
          key: 'father',
          name: 'Ø§Ù„Ø£Ø¨',
          type: 'ÙØ±Ø¶',
          fraction: Fraction.SIXTH,
          count: 1,
          reason: 'â…™ ÙØ±Ø¶Ø§Ù‹ Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø« Ø§Ù„Ø°ÙƒØ±'
        }));
      } else if (this.hasFemaleDescendants()) {
        // Ù…Ø¹ Ø¨Ù†Øª/Ø¨Ù†Øª Ø§Ø¨Ù† ÙÙ‚Ø·: Ø§Ù„Ø³Ø¯Ø³ + Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØªØ¹ØµÙŠØ¨Ø§Ù‹
        shares.push(new HeirShare({
          key: 'father',
          name: 'Ø§Ù„Ø£Ø¨',
          type: 'ÙØ±Ø¶ + ØªØ¹ØµÙŠØ¨',
          fraction: Fraction.SIXTH, // Ø³ÙŠÙØ¶Ø§Ù Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹
          count: 1,
          reason: 'â…™ ÙØ±Ø¶Ø§Ù‹ + Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØªØ¹ØµÙŠØ¨Ø§Ù‹ Ù„ÙˆØ¬ÙˆØ¯ ÙØ±Ø¹ ÙˆØ§Ø±Ø« Ø£Ù†Ø«Ù‰ ÙÙ‚Ø·'
        }));
      }
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ÙØ±Ø¹: ÙŠØ±Ø« Ø¨Ø§Ù„ØªØ¹ØµÙŠØ¨ ÙÙ‚Ø· (ÙŠÙØ¹Ø§Ù„Ø¬ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    }
    
    // ===== Ø§Ù„Ø¬Ø¯ =====
    if (h.grandfather > 0 && h.father === 0) {
      const siblingsExist = this.getFullAndPaternalSiblingsCount() > 0;
      const rules = this.config.rules;
      
      if (this.hasMaleDescendants()) {
        shares.push(new HeirShare({
          key: 'grandfather',
          name: 'Ø§Ù„Ø¬Ø¯',
          type: 'ÙØ±Ø¶',
          fraction: Fraction.SIXTH,
          count: 1,
          reason: 'â…™ ÙØ±Ø¶Ø§Ù‹ Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø« Ø§Ù„Ø°ÙƒØ±'
        }));
      } else if (this.hasFemaleDescendants()) {
        shares.push(new HeirShare({
          key: 'grandfather',
          name: 'Ø§Ù„Ø¬Ø¯',
          type: 'ÙØ±Ø¶ + ØªØ¹ØµÙŠØ¨',
          fraction: Fraction.SIXTH,
          count: 1,
          reason: 'â…™ ÙØ±Ø¶Ø§Ù‹ + Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØªØ¹ØµÙŠØ¨Ø§Ù‹ Ù„ÙˆØ¬ÙˆØ¯ ÙØ±Ø¹ ÙˆØ§Ø±Ø« Ø£Ù†Ø«Ù‰ ÙÙ‚Ø·'
        }));
      } else if (siblingsExist && rules.grandfatherWithSiblings === 'shares') {
        // Ø§Ù„Ø¬Ø¯ Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ© ÙÙŠ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ ÙˆØ§Ù„Ø­Ù†Ø¨Ù„ÙŠ - ÙŠÙØ¹Ø§Ù„Ø¬ ÙÙŠ Ø§Ù„Ø¹ØµØ¨Ø§Øª
        this.state.madhhabNotes.push(
          `ÙÙŠ Ø§Ù„Ù…Ø°Ù‡Ø¨ ${this.config.name}: Ø§Ù„Ø¬Ø¯ ÙŠÙÙ‚Ø§Ø³Ù… Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙˆÙ„Ø£Ø¨ØŒ ÙˆÙŠØ®ØªØ§Ø± Ø§Ù„Ø£ÙØ¶Ù„ Ù„Ù‡ Ù…Ù†: Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø© Ø£Ùˆ Ø«Ù„Ø« Ø§Ù„Ù…Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø³Ø¯Ø³`
        );
      }
      // Ø¨Ø¯ÙˆÙ† ÙØ±Ø¹ ÙˆØ¨Ø¯ÙˆÙ† Ø¥Ø®ÙˆØ©: ÙŠØ±Ø« Ø¨Ø§Ù„ØªØ¹ØµÙŠØ¨ ÙÙ‚Ø·
    }
    
    // ===== Ø§Ù„Ø¬Ø¯Ø§Øª =====
    const grandmothersCount = (h.grandmother_mother || 0) + (h.grandmother_father || 0);
    if (grandmothersCount > 0) {
      const names = [];
      if (h.grandmother_mother > 0) names.push('Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù…');
      if (h.grandmother_father > 0) names.push('Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨');
      
      shares.push(new HeirShare({
        key: 'grandmothers',
        name: grandmothersCount > 1 ? 'Ø§Ù„Ø¬Ø¯Ø§Øª' : names[0],
        type: 'ÙØ±Ø¶',
        fraction: Fraction.SIXTH,
        count: grandmothersCount,
        reason: grandmothersCount > 1 ? 'â…™ ÙŠØ´ØªØ±ÙƒÙ† ÙÙŠÙ‡' : 'â…™'
      }));
    }
    
    // ===== Ø§Ù„Ø¨Ù†Ø§Øª =====
    if (h.daughter > 0 && h.son === 0) {
      // Ø§Ù„Ø¨Ù†Ø§Øª Ù…Ø¹ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ø¨Ù† - ÙŠØ£Ø®Ø°Ù† ÙØ±Ø¶Ø§Ù‹
      const frac = h.daughter === 1 ? Fraction.HALF : Fraction.TWO_THIRDS;
      shares.push(new HeirShare({
        key: 'daughter',
        name: h.daughter > 1 ? 'Ø§Ù„Ø¨Ù†Ø§Øª' : 'Ø§Ù„Ø¨Ù†Øª',
        type: 'ÙØ±Ø¶',
        fraction: frac,
        count: h.daughter,
        reason: h.daughter === 1 

? 'Â½ Ù„Ù„Ø¨Ù†Øª Ø§Ù„ÙˆØ§Ø­Ø¯Ø©' : 'â…” Ù„Ù„Ø¨Ù†ØªÙŠÙ† ÙØ£ÙƒØ«Ø±'
      }));
    }
    // Ø§Ù„Ø¨Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø§Ø¨Ù† - ÙŠÙØ¹Ø§Ù„Ø¬ ÙÙŠ Ø§Ù„Ø¹ØµØ¨Ø§Øª
    
    // ===== Ø¨Ù†Ø§Øª Ø§Ù„Ø§Ø¨Ù† =====
    if (h.granddaughter > 0 && h.grandson === 0 && h.son === 0) {
      if (h.daughter === 0) {
        // Ø¨Ù†Ø§Øª Ø§Ù„Ø§Ø¨Ù† ÙÙ‚Ø·
        const frac = h.granddaughter === 1 ? Fraction.HALF : Fraction.TWO_THIRDS;
        shares.push(new HeirShare({
          key: 'granddaughter',
          name: h.granddaughter > 1 ? 'Ø¨Ù†Ø§Øª Ø§Ù„Ø§Ø¨Ù†' : 'Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†',
          type: 'ÙØ±Ø¶',
          fraction: frac,
          count: h.granddaughter,
          reason: h.granddaughter === 1 ? 'Â½ Ù„Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† Ø§Ù„ÙˆØ§Ø­Ø¯Ø©' : 'â…” Ù„Ø¨Ù†Ø§Øª Ø§Ù„Ø§Ø¨Ù†'
        }));
      } else if (h.daughter === 1) {
        // Ø¨Ù†Øª ÙˆØ§Ø­Ø¯Ø© + Ø¨Ù†Ø§Øª Ø§Ø¨Ù† = Ø§Ù„Ø³Ø¯Ø³ ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø«Ù„Ø«ÙŠÙ†
        shares.push(new HeirShare({
          key: 'granddaughter',
          name: h.granddaughter > 1 ? 'Ø¨Ù†Ø§Øª Ø§Ù„Ø§Ø¨Ù†' : 'Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†',
          type: 'ÙØ±Ø¶',
          fraction: Fraction.SIXTH,
          count: h.granddaughter,
          reason: 'â…™ ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø«Ù„Ø«ÙŠÙ† Ù…Ø¹ Ø§Ù„Ø¨Ù†Øª Ø§Ù„ÙˆØ§Ø­Ø¯Ø©'
        }));
      }
      // Ù…Ø¹ Ø¨Ù†ØªÙŠÙ† ÙØ£ÙƒØ«Ø± Ø¨Ø¯ÙˆÙ† Ø§Ø¨Ù† Ø§Ø¨Ù† - Ù…Ø­Ø¬ÙˆØ¨Ø§Øª (ØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡ ÙÙŠ Ø§Ù„Ø­Ø¬Ø¨)
    }
    
    // ===== Ø§Ù„Ø£Ø®ÙˆØ§Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø§Øª =====
    if (h.full_sister > 0 && h.full_brother === 0) {
      // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø®Øª Ø³ØªÙƒÙˆÙ† Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±
      const isAsabaWithGhayr = this.hasFemaleDescendants();
      
      if (!isAsabaWithGhayr && !hasDesc && !this.hasMaleAscendant()) {
        const frac = h.full_sister === 1 ? Fraction.HALF : Fraction.TWO_THIRDS;
        shares.push(new HeirShare({
          key: 'full_sister',
          name: h.full_sister > 1 ? 'Ø§Ù„Ø£Ø®ÙˆØ§Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø§Øª' : 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©',
          type: 'ÙØ±Ø¶',
          fraction: frac,
          count: h.full_sister,
          reason: h.full_sister === 1 ? 'Â½ Ù„Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©' : 'â…” Ù„Ù„Ø£Ø®ÙˆØ§Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø§Øª'
        }));
      }
      // Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ± - ÙŠÙØ¹Ø§Ù„Ø¬ ÙÙŠ Ø§Ù„Ø¹ØµØ¨Ø§Øª
    }
    
    // ===== Ø§Ù„Ø£Ø®ÙˆØ§Øª Ù„Ø£Ø¨ =====
    if (h.paternal_sister > 0 && h.paternal_brother === 0 && h.full_brother === 0) {
      const isAsabaWithGhayr = this.hasFemaleDescendants() && h.full_sister === 0;
      
      if (!isAsabaWithGhayr && !hasDesc && !this.hasMaleAscendant()) {
        if (h.full_sister === 0) {
          const frac = h.paternal_sister === 1 ? Fraction.HALF : Fraction.TWO_THIRDS;
          shares.push(new HeirShare({
            key: 'paternal_sister',
            name: h.paternal_sister > 1 ? 'Ø§Ù„Ø£Ø®ÙˆØ§Øª Ù„Ø£Ø¨' : 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨',
            type: 'ÙØ±Ø¶',
            fraction: frac,
            count: h.paternal_sister,
            reason: h.paternal_sister === 1 ? 'Â½ Ù„Ù„Ø£Ø®Øª Ù„Ø£Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯Ø©' : 'â…” Ù„Ù„Ø£Ø®ÙˆØ§Øª Ù„Ø£Ø¨'
          }));
        } else if (h.full_sister === 1) {
          // Ø§Ù„Ø³Ø¯Ø³ ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø«Ù„Ø«ÙŠÙ†
          shares.push(new HeirShare({
            key: 'paternal_sister',
            name: h.paternal_sister > 1 ? 'Ø§Ù„Ø£Ø®ÙˆØ§Øª Ù„Ø£Ø¨' : 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨',
            type: 'ÙØ±Ø¶',
            fraction: Fraction.SIXTH,
            count: h.paternal_sister,
            reason: 'â…™ ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø«Ù„Ø«ÙŠÙ† Ù…Ø¹ Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©'
          }));
        }
      }
    }
    
    // ===== Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… =====
    const maternalCount = this.getMaternalSiblingsCount();
    if (maternalCount > 0 && !hasDesc && !this.hasMaleAscendant()) {
      const frac = maternalCount === 1 ? Fraction.SIXTH : Fraction.THIRD;
      shares.push(new HeirShare({
        key: 'maternal_siblings',
        name: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…',
        type: 'ÙØ±Ø¶',
        fraction: frac,
        count: maternalCount,
        reason: maternalCount === 1 ? 
          'â…™ Ù„Ù„ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…' : 
          'â…“ ÙŠØ´ØªØ±ÙƒÙˆÙ† ÙÙŠÙ‡ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ (Ø°ÙƒØ±Ù‡Ù… ÙƒØ£Ù†Ø«Ø§Ù‡Ù…)'
      }));
    }
    
    return shares;
  }
  
  // ========== Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø§Ù„Ø­Ù…Ø§Ø±ÙŠØ©) ==========
  computeMusharraka() {
    this.state.specialCases.push({
      type: 'musharraka',
      name: 'Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø§Ù„Ø­Ù…Ø§Ø±ÙŠØ©)',
      description: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙŠØ´ØªØ±ÙƒÙˆÙ† Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… ÙÙŠ Ø§Ù„Ø«Ù„Ø« Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ'
    });
    
    this.addStep('Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©', 'ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡ ÙŠØ´Ø§Ø±ÙƒÙˆÙ† Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù…');
    
    const h = this.heirs;
    const shares = [];
    
    // Ø§Ù„Ø²ÙˆØ¬: Ø§Ù„Ù†ØµÙ
    shares.push(new HeirShare({
      key: 'husband',
      name: 'Ø§Ù„Ø²ÙˆØ¬',
      type: 'ÙØ±Ø¶',
      fraction: Fraction.HALF,
      count: 1,
      reason: 'Â½ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙØ±Ø¹ ÙˆØ§Ø±Ø«'
    }));
    
    // Ø§Ù„Ø£Ù… Ø£Ùˆ Ø§Ù„Ø¬Ø¯Ø©: Ø§Ù„Ø³Ø¯Ø³
    if (h.mother > 0) {
      shares.push(new HeirShare({
        key: 'mother',
        name: 'Ø§Ù„Ø£Ù…',
        type: 'ÙØ±Ø¶',
        fraction: Fraction.SIXTH,
        count: 1,
        reason: 'â…™ Ù„ÙˆØ¬ÙˆØ¯ Ø¬Ù…Ø¹ Ù…Ù† Ø§Ù„Ø¥Ø®ÙˆØ©'
      }));
    } else if (h.grandmother_mother > 0) {
      shares.push(new HeirShare({
        key: 'grandmother_mother',
        name: 'Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù…',
        type: 'ÙØ±Ø¶',
        fraction: Fraction.SIXTH,
        count: 1,
        reason: 'â…™'
      }));
    }
    
    // Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… + Ø§Ù„Ø¥Ø®ÙˆØ© Ø§Ù„Ø£Ø´Ù‚Ø§Ø¡: Ø§Ù„Ø«Ù„Ø« Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ
    const maternalCount = this.getMaternalSiblingsCount();
    const fullCount = this.getFullSiblingsCount();
    const totalSiblings = maternalCount + fullCount;
    
    shares.push(new HeirShare({
      key: 'shared_siblings',
      name: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… ÙˆØ§Ù„Ø£Ø´Ù‚Ø§Ø¡ (Ù…Ø´ØªØ±ÙƒØ©)',
      type: 'ÙØ±Ø¶',
      fraction: Fraction.THIRD,
      count: totalSiblings,
      reason: 'â…“ ÙŠØ´ØªØ±ÙƒÙˆÙ† ÙÙŠÙ‡ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ (Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©)'
    }));
    
    return shares;
  }
  
  // ========== Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ© ==========
  computeAkdariyya() {
    this.state.specialCases.push({
      type: 'akdariyya',
      name: 'Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ© (Ø§Ù„ØºØ±Ù‘Ø§Ø¡)',
      description: 'Ù…Ø³Ø£Ù„Ø© ÙØ±ÙŠØ¯Ø© ÙŠÙÙØ±Ø¶ Ù„Ù„Ø£Ø®Øª Ù…Ø¹ Ø§Ù„Ø¬Ø¯ Ø«Ù… ÙŠÙØ¬Ù…Ø¹ Ù†ØµÙŠØ¨Ø§Ù‡Ù…Ø§ ÙˆÙŠÙÙ‚Ø³Ù… Ø¨ÙŠÙ†Ù‡Ù…Ø§ Ù„Ù„Ø°ÙƒØ± Ù…Ø«Ù„ Ø­Ø¸ Ø§Ù„Ø£Ù†Ø«ÙŠÙŠÙ†'
    });
    
    this.addStep('Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©', 'ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ© Ø§Ù„Ø®Ø§ØµØ©');
    
    const shares = [];
    
    // Ø§Ù„Ø²ÙˆØ¬: Ø§Ù„Ù†ØµÙ (3/6)
    shares.push(new HeirShare({
      key: 'husband',
      name: 'Ø§Ù„Ø²ÙˆØ¬',
      type: 'ÙØ±Ø¶',
      fraction: Fraction.HALF,
      count: 1,
      reason: 'Â½ = 3/6'
    }));
    
    // Ø§Ù„Ø£Ù…: Ø§Ù„Ø«Ù„Ø« (2/6)
    shares.push(new HeirShare({
      key: 'mother',
      name: 'Ø§Ù„Ø£Ù…',
      type: 'ÙØ±Ø¶',
      fraction: Fraction.THIRD,
      count: 1,
      reason: 'â…“ = 2/6'
    }));
    
    // Ø§Ù„Ø¬Ø¯: Ø§Ù„Ø³Ø¯Ø³ Ø£ØµØ§Ù„Ø© (1/6)
    // Ø§Ù„Ø£Ø®Øª: Ø§Ù„Ù†ØµÙ Ø£ØµØ§Ù„Ø© (3/6)
    // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 9/6 = Ø¹Ø§Ø¦Ù„Ø©
    // Ø«Ù… ÙŠÙØ¬Ù…Ø¹ Ù†ØµÙŠØ¨ Ø§Ù„Ø¬Ø¯ ÙˆØ§Ù„Ø£Ø®Øª (1+3=4) ÙˆÙŠÙÙ‚Ø³Ù… 2:1
    // Ø§Ù„Ø¬Ø¯: 4 Ã— 2/3 = 8/3 Ù…Ù† 9
    // Ø§Ù„Ø£Ø®Øª: 4 Ã— 1/3 = 4/3 Ù…Ù† 9
    
    // Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ© Ù…Ù† 27:
    // Ø§Ù„Ø²ÙˆØ¬: 9ØŒ Ø§Ù„Ø£Ù…: 6ØŒ Ø§Ù„Ø¬Ø¯: 8ØŒ Ø§Ù„Ø£Ø®Øª: 4
    
    shares.push(new HeirShare({
      key: 'grandfather',
      name: 'Ø§Ù„Ø¬Ø¯',
      type: 'ÙØ±Ø¶ + ØªØ¹ØµÙŠØ¨',
      fraction: new Fraction(8, 27),
      count: 1,
      reason: 'Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©: â…™ + Ø­ØµØªÙ‡ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø© Ù…Ø¹ Ø§Ù„Ø£Ø®Øª'
    }));
    
    shares.push(new HeirShare({
      key: 'full_sister',
      name: 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©',
      type: 'ÙØ±Ø¶ + ØªØ¹ØµÙŠØ¨',
      fraction: new Fraction(4, 27),
      count: 1,
      reason: 'Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©: Â½ Ø«Ù… Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø© Ù…Ø¹ Ø§Ù„Ø¬Ø¯'
    }));
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ±ÙˆØ¶ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹ÙˆÙ„
    shares[0].fraction = new Fraction(9, 27); // Ø§Ù„Ø²ÙˆØ¬
    shares[1].fraction = new Fraction(6, 27); // Ø§Ù„Ø£Ù…
    
    this.results.awlApplied = true;
    this.results.asl = 6;
    this.results.finalBase = 27;
    
    return shares;
  }
  
  // ========== Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª ==========
  computeAsaba(fixedShares, remainder) {
    this.addStep('Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª', 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³ ÙˆØ¨Ø§Ù„ØºÙŠØ± ÙˆÙ…Ø¹ Ø§Ù„ØºÙŠØ±');
    const asabaShares = [];
    const h = this.heirs;
    const rules = this.config.rules;
    
    if (remainder.num <= 0) {
      this.addStep('Ø§Ù„Ø¹ØµØ¨Ø§Øª', 'Ù„Ø§ Ø¨Ø§Ù‚ÙŠ Ù„Ù„Ø¹ØµØ¨Ø§Øª (Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø¹Ø§Ø¯Ù„Ø© Ø£Ùˆ Ø¹Ø§Ø¦Ù„Ø©)');
      return asabaShares;
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª:
    // 1. Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø°ÙƒÙˆØ± (Ø§Ø¨Ù†ØŒ Ø§Ø¨Ù† Ø§Ø¨Ù†)
    // 2. Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø°ÙƒÙˆØ± (Ø£Ø¨ØŒ Ø¬Ø¯)
    // 3. Ø§Ù„Ø¥Ø®ÙˆØ© ÙˆØ£Ø¨Ù†Ø§Ø¤Ù‡Ù…
    // 4. Ø§Ù„Ø£Ø¹Ù…Ø§Ù… ÙˆØ£Ø¨Ù†Ø§Ø¤Ù‡Ù…
    
    let asabaFound = false;
    let asabaList = [];
    
    // ===== 1. Ø§Ù„Ø§Ø¨Ù† (Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³) ÙŠÙØ¹ØµÙ‘Ø¨ Ø§Ù„Ø¨Ù†Øª =====
    if (h.son > 0) {
      asabaFound = true;
      // Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„Ø¨Ù†Ø§Øª: Ù„Ù„Ø°ÙƒØ± Ù…Ø«Ù„ Ø­Ø¸ Ø§Ù„Ø£Ù†Ø«ÙŠÙŠÙ†
      for (let i = 0; i < h.son; i++) {
        asabaList.push({ key: 'son', name: 'Ø§Ù„Ø§Ø¨Ù†', weight: 2 });
      }
      for (let i = 0; i < (h.daughter || 0); i++) {
        asabaList.push({ key: 'daughter', name: 'Ø§Ù„Ø¨Ù†Øª', weight: 1 });
      }
    }
    
    // ===== 2. Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù† (Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³) ÙŠÙØ¹ØµÙ‘Ø¨ Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† =====
    else if (h.grandson > 0) {
      asabaFound = true;
      for (let i = 0; i < h.grandson; i++) {
        asabaList.push({ key: 'grandson', name: 'Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†', weight: 2 });
      }
      for (let i = 0; i < (h.granddaughter || 0); i++) {
        asabaList.push({ key: 'granddaughter', name: 'Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†', weight: 1 });
      }
    }
    
    // ===== 3. Ø§Ù„Ø£Ø¨ (Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³) =====
    else if (h.father > 0 && !this.hasMaleDescendants()) {
      asabaFound = true;
      // Ø§Ù„Ø£Ø¨ ÙŠØ£Ø®Ø° Ø§Ù„Ø¨Ø§Ù‚ÙŠ (Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¯Ø³ Ø¥Ù† ÙˆÙØ¬Ø¯ ÙØ±Ø¹ Ø£Ù†Ø«Ù‰)
      const fatherShare = fixedShares.find(s => s.key === 'father');
      if (fatherShare) {
        // Ù„Ù‡ ÙØ±Ø¶ØŒ Ø³Ù†Ø¶ÙŠÙ Ù„Ù‡ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
        asabaList.push({ key: 'father', name: 'Ø§Ù„Ø£Ø¨', weight: 1, addToExisting: true });
      } else {
        asabaList.push({ key: 'father', name: 'Ø§Ù„Ø£Ø¨', weight: 1 });
      }
    }
    
    // ===== 4. Ø§Ù„Ø¬Ø¯ Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ© (Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ ÙˆØ§Ù„Ø­Ù†Ø¨Ù„ÙŠ) =====
    else if (h.grandfather > 0 && h.father === 0) {
      const siblingsCount = this.getFullAndPaternalSiblingsCount();
      
      if (siblingsCount > 0 && rules.grandfatherWithSiblings === 'shares') {
        // Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø© Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ©
        asabaFound = true;
        this.state.specialCases.push({
          type: 'grandfather_with_siblings',
          name: 'Ø§Ù„Ø¬Ø¯ Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ©',
          description: `Ø§Ù„Ø¬Ø¯ ÙŠÙÙ‚Ø§Ø³Ù… Ø§Ù„Ø¥Ø®ÙˆØ© ÙÙŠ Ø§Ù„Ù…Ø°Ù‡Ø¨ ${this.config.name}`
        });
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙØ¶Ù„ Ù„Ù„Ø¬Ø¯
        const totalHeads = 2 + (h.full_brother || 0) * 2 + (h.full_sister || 0) + 
                          (h.paternal_brother || 0) * 2 + (h.paternal_sister || 0);
        const grandfatherByMuqasama = new Fraction(2, totalHeads);
        const grandfatherByThird = Fraction.THIRD;
        const grandfatherBySixth = Fraction.SIXTH;
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙØ¶Ù„
        let bestOption = grandfatherByMuqasama;
        let bestReason = 'Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø©';
        
        if (grandfatherByThird.greaterThan(bestOption)) {
          bestOption = grandfatherByThird;
          bestReason = 'Ø«Ù„Ø« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„';
        }
        
        // Ø§Ù„Ø¬Ø¯ ÙŠØ£Ø®Ø° Ø§Ù„Ø£ÙØ¶Ù„
        asabaList.push({ key: 'grandfather', name: 'Ø§Ù„Ø¬Ø¯', weight: 2 });
        
        // Ø§Ù„Ø¥Ø®ÙˆØ©
        for (let i = 0; i < (h.full_brother || 0); i++) {
          asabaList.push({ key: 'full_brother', name: 'Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚', weight: 2 });
        }
        for (let i = 0; i < (h.full_sister || 0); i++) {
          asabaList.push({ key: 'full_sister', name: 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©', weight: 1 });
        }
        for (let i = 0; i < (h.paternal_brother || 0); i++) {
          asabaList.push({ key: 'paternal_brother', name: 'Ø§Ù„Ø£Ø® Ù„Ø£Ø¨', weight: 2 });
        }
        for (let i = 0; i < (h.paternal_sister || 0); i++) {
          asabaList.push({ key: 'paternal_sister', name: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨', weight: 1 });
        }
        
      } else if (!this.hasMaleDescendants()) {
        // Ø§Ù„Ø¬Ø¯ ÙˆØ­Ø¯Ù‡
        asabaFound = true;
        const grandfatherShare = fixedShares.find(s => s.key === 'grandfather');
        if (grandfatherShare) {
          asabaList.push({ key: 'grandfather', name: 'Ø§Ù„Ø¬Ø¯', weight: 1, addToExisting: true });
        } else {
          asabaList.push({ key: 'grandfather', name: 'Ø§Ù„Ø¬Ø¯', weight: 1 });
        }
      }
    }
    
    // ===== 5. Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚ (Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³) ÙŠÙØ¹ØµÙ‘Ø¨ Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© =====
    else if (h.full_brother > 0) {
      asabaFound = true;
      for (let i = 0; i < h.full_brother; i++) {
        asabaList.push({ key: 'full_brother', name: 'Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚', weight: 2 });
      }
      for (let i = 0; i < (h.full_sister || 0); i++) {
        asabaList.push({ key: 'full_sister', name: 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©', weight: 1 });
      }
    }
    
    // ===== 6. Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ± =====
    else if (h.full_sister > 0 && this.hasFemaleDescendants()) {
      asabaFound = true;
      this.state.specialCases.push({
        type: 'sister_with_daughters',
        name: 'Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±',
        description: 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© ØµØ§Ø±Øª Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„Ø¨Ù†Øª/Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†'
      });
      
      // Ø­Ø°Ù Ø§Ù„Ø£Ø®Øª Ù…Ù† Ø§Ù„ÙØ±ÙˆØ¶ Ø¥Ù† ÙˆÙØ¬Ø¯Øª
      const sisterIndex = fixedShares.findIndex(s => s.key === 'full_sister');
      if (sisterIndex !== -1) {
        fixedShares.splice(sisterIndex, 1);
      }
      
      for (let i = 0; i < h.full_sister; i++) {
        asabaList.push({ key: 'full_sister', name: 'Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©', weight: 1 });
      }
      
      // Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø¹ØµØ¨Ø© ØªØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ø¨
      if (h.paternal_brother > 0 || h.paternal_sister > 0) {
        this.state.blockedHeirs.push({
          heir: 'paternal_siblings',
          by: 'full_sister',
          reason: 'Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ø¨ Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ† Ø¨Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±'
        });
        h.paternal_brother = 0;
        h.paternal_sister = 0;
      }
    }
    
    // ===== 7. Ø§Ù„Ø£Ø® Ù„Ø£Ø¨ (Ø¹ØµØ¨Ø© Ø¨Ø§Ù„Ù†ÙØ³) ÙŠÙØ¹ØµÙ‘Ø¨ Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ =====
    else if (h.paternal_brother > 0) {
      asabaFound = true;
      for (let i = 0; i < h.paternal_brother; i++) {
        asabaList.push({ key: 'paternal_brother', name: 'Ø§Ù„Ø£Ø® Ù„Ø£Ø¨', weight: 2 });
      }
      for (let i = 0; i < (h.paternal_sister || 0); i++) {
        asabaList.push({ key: 'paternal_sister', name: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨', weight: 1 });
      }
    }
    
    // ===== 8. Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ± =====
    else if (h.paternal_sister > 0 && this.hasFemaleDescendants() && h.full_sister === 0) {
      asabaFound = true;
      this.state.specialCases.push({
        type: 'paternal_sister_with_daughters',
        name: 'Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±',
        description: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨ ØµØ§Ø±Øª Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„Ø¨Ù†Øª/Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†'
      });
      
      const sisterIndex = fixedShares.findIndex(s => s.key === 'paternal_sister');
      if (sisterIndex !== -1) {
        fixedShares.splice(sisterIndex, 1);
      }
      
      for (let i = 0; i < h.paternal_sister; i++) {
        asabaList.push({ key: 'paternal_sister', name: 'Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨', weight: 1 });
      }
    }
    
    // ===== 9. Ø§Ù„Ø¹ØµØ¨Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© =====
    else if (h.full_nephew > 0) {
      asabaFound = true;
      for (let i = 0; i < h.full_nephew; i++) {
        asabaList.push({ key: 'full_nephew', name: 'Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚', weight: 1 });
      }
    }
    else if (h.paternal_nephew > 0) {
      asabaFound = true;
      for (let i = 0; i < h.paternal_nephew; i++) {
        asabaList.push({ key: 'paternal_nephew', name: 'Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ù„Ø£Ø¨', weight: 1 });
      }
    }
    else if (h.full_uncle > 0) {
      asabaFound = true;
      for (let i = 0; i < h.full_uncle; i++) {
        asabaList.push({ key: 'full_uncle', name: 'Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚', weight: 1 });
      }
    }
    else if (h.paternal_uncle > 0) {
      asabaFound = true;
      for (let i = 0; i < h.paternal_uncle; i++) {
        asabaList.push({ key: 'paternal_uncle', name: 'Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨', weight: 1 });
      }
    }
    else if (h.full_cousin > 0) {
      asabaFound = true;
      for (let i = 0; i < h.full_cousin; i++) {
        asabaList.push({ key: 'full_cousin', name: 'Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚', weight: 1 });
      }
    }
    else if (h.paternal_cousin > 0) {
      asabaFound = true;
      for (let i = 0; i < h.paternal_cousin; i++) {
        asabaList.push({ key: 'paternal_cousin', name: 'Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨', weight: 1 });
      }
    }
    
    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¹ØµØ¨Ø§Øª
    if (asabaList.length > 0) {
      const totalWeight = asabaList.reduce((sum, a) => sum + a.weight, 0);
      
      // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙØªØ§Ø­
      const grouped = {};
      asabaList.forEach(a => {
        if (!grouped[a.key]) {
          grouped[a.key] = { 
            name: a.name, 
            weight: 0, 
            count: 0, 
            addToExisting: a.addToExisting 
          };
        }
        grouped[a.key].weight += a.weight;
        grouped[a.key].count++;
      });
      
      for (const [key, data] of Object.entries(grouped)) {
        const shareFrac = remainder.multiply(new Fraction(data.weight, totalWeight));
        
        if (data.addToExisting) {
          // Ø¥Ø¶Ø§ÙØ© Ù„Ù„ÙØ±Ø¶ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
          const existing = fixedShares.find(s => s.key === key);
          if (existing) {
            existing.addFraction(shareFrac);
            existing.type = 'ÙØ±Ø¶ + ØªØ¹ØµÙŠØ¨';
            existing.reason += ' + Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØªØ¹ØµÙŠØ¨Ø§Ù‹';
          }
        } else {
          asabaShares.push(new HeirShare({
            key,
            name: data.name,
            type: 'Ø¹ØµØ¨Ø©',
            fraction: shareFrac,
            count: data.count,
            reason: `Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØªØ¹ØµÙŠØ¨Ø§Ù‹ (${data.weight}/${totalWeight})`
          }));
        }
      }
    }
    
    return asabaShares;
  }
  
  // ========== Ø§Ù„Ø¹ÙˆÙ„ ==========
  applyAwl(shares) {
    if (shares.length === 0) {
      this.results.asl = 1;
      this.results.finalBase = 1;
      return shares;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø£ØµÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© (Ø§Ù„Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø£ØµØºØ± Ù„Ù„Ù…Ù‚Ø§Ù…Ø§Øª)
    const denominators = shares
      .filter(s => s.fraction && !s.fraction.isZero())
      .map(s => s.fraction.den);
    
    if (denominators.length === 0) {
      this.results.asl = 1;
      this.results.finalBase = 1;
      return shares;
    }
    
    const asl = Fraction.lcmArray(denominators);
    this.results.asl = asl;
    
    // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ù‡Ø§Ù…
    let totalShares = 0;
    const shareDetails = shares.map(share => {
      if (!share.fraction || share.fraction.isZero()) {
        return { share, rawShares: 0 };
      }
      const rawShares = share.fraction.num * (asl / share.fraction.den);
      totalShares += rawShares;
      return { share, rawShares };
    });
    
    // ÙØ­Øµ Ø§Ù„Ø¹ÙˆÙ„
    if (totalShares > asl) {
      this.results.awlApplied = true;
      this.results.finalBase = totalShares;
      this.results.awlRatio = new Fraction(asl, totalShares);
      
      this.state.specialCases.push({
        type: 'awl',
        name: 'Ø§Ù„Ø¹ÙÙˆÙ’Ù„',
        description: `Ø¹Ø§Ù„Øª Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ù…Ù† ${asl} Ø¥Ù„Ù‰ ${totalShares}`
      });
      
      this.addStep('Ø§Ù„Ø¹ÙÙˆÙ’Ù„', 
        `Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ù‡Ø§Ù… (${totalShares}) Ø£ÙƒØ¨Ø± Ù…Ù† Ø£ØµÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© (${asl})ØŒ ÙØ¹Ø§Ù„Øª Ø¥Ù„Ù‰ ${totalShares}`
      );
      
      // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ³ÙˆØ±
      return shareDetails.map(({ share, rawShares }) => {
        share.originalFraction = share.fraction.clone();
        share.fraction = new Fraction(rawShares, totalShares);
        share.shares = rawShares;
        return share;
      });
    } else {
      this.results.finalBase = asl;
      return shareDetails.map(({ share, rawShares }) => {
        share.shares = rawShares;
        return share;
      });
    }
  }
  
  // ========== Ø§Ù„Ø±Ø¯ ==========
  applyRadd(shares, remainder) {
    if (remainder.num <= 0) return shares;
    
    const rules = this.config.rules;
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ­Ù‚ÙŠÙ† Ù„Ù„Ø±Ø¯
    let eligibleForRadd = shares.filter(s => {
      if (s.type.includes('Ø¹ØµØ¨Ø©')) return false; // Ø§Ù„Ø¹ØµØ¨Ø© Ù„Ø§ ÙŠÙØ±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§
      if (s.key === 'husband' || s.key === 'wife') {
        // Ø§Ù„Ø²ÙˆØ¬Ø§Ù† Ù„Ø§ ÙŠÙØ±Ø¯ Ø¹Ù„ÙŠÙ‡Ù…Ø§ Ø¥Ù„Ø§ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ ÙˆØ¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØºÙŠØ±Ù‡Ù…
        return false;
      }
      return true;
    });
    
    if (eligibleForRadd.length === 0) {
      // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù† ÙŠÙØ±Ø¯ Ø¹Ù„ÙŠÙ‡ Ù…Ù† Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶
      // ÙØ­Øµ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬ÙŠÙ†
      if (rules.raddToSpouse) {
        const spouse = shares.find(s => s.key === 'husband' || s.key === 'wife');
        if (spouse && shares.length === 1) {
          // Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø© ÙÙ‚Ø·
          this.state.madhhabNotes.push(
            `ÙÙŠ Ø§Ù„Ù…Ø°Ù‡Ø¨ ${this.config.name}: ÙŠÙØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙˆØ§Ø±Ø« Ø¢Ø®Ø±`
          );
          eligibleForRadd = [spouse];
        }
      }
    }
    
    if (eligibleForRadd.length === 0) {
      return shares;
    }
    
    this.results.raddApplied = true;
    this.state.specialCases.push({
      type: 'radd',
      name: 'Ø§Ù„Ø±ÙÙ‘Ø¯',
      description: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø¶ Ø¹Ù„Ù‰ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø¨Ù†Ø³Ø¨Ø© ÙØ±ÙˆØ¶Ù‡Ù…'
    });
    
    this.addStep('Ø§Ù„Ø±ÙÙ‘Ø¯', 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø¨Ù†Ø³Ø¨Ø© ÙØ±ÙˆØ¶Ù‡Ù…');
    
    // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ ÙØ±ÙˆØ¶ Ø§Ù„Ù…Ø³ØªØ­Ù‚ÙŠÙ†
    let totalEligibleFrac = new Fraction(0);
    eligibleForRadd.forEach(s => {
      totalEligibleFrac = totalEligibleFrac.add(s.fraction);
    });
    
    if (totalEligibleFrac.isZero()) return shares;
    
    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø¶
    return shares.map(share => {
      if (eligibleForRadd.includes(share)) {
        const raddPortion = remainder.multiply(share.fraction).divide(totalEligibleFrac);
        share.addFraction(raddPortion);
        if (!share.type.includes('Ø±Ø¯')) {
          share.type = share.type + ' + Ø±Ø¯';
        }
      }
      return share;
    });
  }
  
  // ========== Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… ==========
  distributeToBloodRelatives(shares, remainder) {
    if (!this.config.rules.bloodRelativesEnabled) {
      // ÙÙŠ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ: Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„
      if (remainder.isPositive() && this.madhab === 'maliki') {
        shares.push(new HeirShare({
          key: 'treasury',
          name: 'Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„',
          type: 'Ø¨Ø§Ù‚ÙŠ',
          fraction: remainder,
          count: 1,
          reason: 'Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ)'
        }));
        this.state.madhhabNotes.push('ÙÙŠ Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ: Ù„Ø§ ÙŠØ±Ø« Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…ØŒ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„');
      }
      return { shares, bloodRelatives: [] };
    }
    
    if (remainder.num <= 0) {
      return { shares, bloodRelatives: [] };
    }
    
    const h = this.heirs;
    const bloodRelatives = [];
    
    // ØªØ¬Ù…ÙŠØ¹ Ø°ÙˆÙŠ Ø§Ù„Ø£Ø±Ø­Ø§Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù
    const classes = {
      1: [], // Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø¨Ù†Ø§Øª
      2: [], // Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø£Ø®ÙˆØ§Øª
      3: [], // Ø§Ù„Ø£Ø®ÙˆØ§Ù„ ÙˆØ§Ù„Ø®Ø§Ù„Ø§Øª
      4: []  // Ø§Ù„Ø¹Ù…Ø§Øª
    };
    
    if ((h.daughter_son || 0) > 0) {
      classes[1].push({ key: 'daughter_son', count: h.daughter_son, name: 'Ø§Ø¨Ù† Ø§Ù„Ø¨Ù†Øª' });
    }
    if ((h.daughter_daughter || 0) > 0) {
      classes[1].push({ key: 'daughter_daughter', count: h.daughter_daughter, name: 'Ø¨Ù†Øª Ø§Ù„Ø¨Ù†Øª' });
    }
    if ((h.sister_children || 0) > 0) {
      classes[2].push({ key: 'sister_children', count: h.sister_children, name: 'Ø£ÙˆÙ„Ø§Ø¯ Ø§Ù„Ø£Ø®Øª' });
    }
    if ((h.maternal_uncle || 0) > 0) {
      classes[3].push({ key: 'maternal_uncle', count: h.maternal_uncle, name: 'Ø§Ù„Ø®Ø§Ù„' });
    }
    if ((h.maternal_aunt || 0) > 0) {
      classes[3].push({ key: 'maternal_aunt', count: h.maternal_aunt, name: 'Ø§Ù„Ø®Ø§Ù„Ø©' });
    }
    if ((h.paternal_aunt || 0) > 0) {
      classes[4].push({ key: 'paternal_aunt', count: h.paternal_aunt, name: 'Ø§Ù„Ø¹Ù…Ø©' });
    }
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù Ø§Ù„Ø£ÙˆÙ„Ù‰
    let inheritingClass = null;
    for (let i = 1; i <= 4; i++) {
      if (classes[i].length > 0) {
        inheritingClass = classes[i];
        break;
      }
    }
    
    if (!inheritingClass || inheritingClass.length === 0) {
      return { shares, bloodRelatives: [] };
    }
    
    this.results.bloodRelativesApplied = true;
    this.state.specialCases.push({
      type: 'blood_relatives',
      name: 'Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…',
      description: 'ØªÙˆØ±ÙŠØ« Ø°ÙˆÙŠ Ø§Ù„Ø£Ø±Ø­Ø§Ù… Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¹ØµØ¨Ø©'
    });
    
    this.addStep('Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…', 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø°ÙˆÙŠ Ø§Ù„Ø£Ø±Ø­Ø§Ù…');
    
    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ù Ø§Ù„ÙˆØ§Ø±Ø«
    const totalCount = inheritingClass.reduce((sum, r) => sum + r.count, 0);
    
    inheritingClass.forEach(rel => {
      const shareFrac = remainder.multiply(new Fraction(rel.count, totalCount));
      bloodRelatives.push(new HeirShare({
        key: rel.key,
        name: rel.name,
        type: 'Ø°Ùˆ Ø±Ø­Ù…',
        fraction: shareFrac,
        count: rel.count,
        reason: 'Ø°Ùˆ Ø±Ø­Ù… - Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶'
      }));
    });
    
    return { shares, bloodRelatives };
  }
  
  // ========== Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø¹Ø§Ø¯Ù„ ==========
  fairRounding(shares, netEstate) {
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
    shares.forEach(s => s.calculateAmount(netEstate));
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
    let total = shares.reduce((sum, s) => sum + s.amount, 0);
    
    // ØªØµØ­ÙŠØ­ ÙØ±ÙˆÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨
    const diff = netEstate - total;
    if (Math.abs(diff) >= 0.01 && shares.length > 0) {
      // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ±Ù‚ Ø¹Ù„Ù‰ Ø£ÙƒØ¨Ø± Ø§Ù„Ø­ØµØµ
      const sorted = [...shares].sort((a, b) => b.amount - a.amount);
      const cents = Math.abs(Math.round(diff * 100));
      const sign = diff > 0 ? 1 : -1;
      
      for (let i = 0; i < cents && i < sorted.length * 10; i++) {
        const idx = i % sorted.length;
        sorted[idx].amount = Math.round((sorted[idx].amount + sign * 0.01) * 100) / 100;
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ù„ÙƒÙ„ ÙØ±Ø¯
      shares.forEach(s => {
        s.amountPerPerson = s.amount / s.count;
      });
    }
  }
  
  // ========== Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ==========
  calculate() {
    try {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡
      if (this.state.errors.length > 0) {
        return {
          success: false,
          errors: this.state.errors,
          madhab: this.madhab,
          madhhabName: this.config.name
        };
      }
      
      // 1. Ø­Ø³Ø§Ø¨ ØµØ§ÙÙŠ Ø§Ù„ØªØ±ÙƒØ©
      const { total, funeral, debts, will } = this.estate;
      const netEstate = total - funeral - debts - will;
      this.results.netEstate = netEstate;
      
      if (netEstate <= 0) {
        return {
          success: false,
          errors: ['ØµØ§ÙÙŠ Ø§Ù„ØªØ±ÙƒØ© ØµÙØ± Ø£Ùˆ Ø³Ø§Ù„Ø¨ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ÙˆØ§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„ÙˆØµÙŠØ©'],
          madhab: this.madhab,
          madhhabName: this.config.name
        };
      }
      
      this.addStep('ØµØ§ÙÙŠ Ø§Ù„ØªØ±ÙƒØ©',
        `${total.toLocaleString()} - ${funeral.toLocaleString()} (ØªØ¬Ù‡ÙŠØ²) - ${debts.toLocaleString()} (Ø¯ÙŠÙˆÙ†) - ${will.toLocaleString()} (ÙˆØµÙŠØ©) = ${netEstate.toLocaleString()}`
      );
      
      // 2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¬Ø¨
      this.applyHijab();
      
      // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶
      let fixedShares = this.computeFixedShares();
      
      // 4. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹ÙˆÙ„
      fixedShares = this.applyAwl(fixedShares);
      
      // 5. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
      let totalFixed = new Fraction(0);
      fixedShares.forEach(s => {
        totalFixed = totalFixed.add(s.fraction);
      });
      let remainder = new Fraction(1).subtract(totalFixed);
      
      // 6. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹ØµØ¨Ø§Øª
      const asabaShares = this.computeAsaba(fixedShares, remainder);
      
      // 7. Ø¯Ù…Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ
      let allShares = [...fixedShares];
      asabaShares.forEach(asaba => {
        const existing = allShares.find(s => s.key === asaba.key);
        if (existing) {
          existing.addFraction(asaba.fraction);
          if (!existing.type.includes('ØªØ¹ØµÙŠØ¨')) {
            existing.type = existing.type + ' + ØªØ¹ØµÙŠØ¨';
          }
        } else {
          allShares.push(asaba);
        }
      });
      
      // 8. Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
      let totalAllocated = new Fraction(0);
      allShares.forEach(s => {
        totalAllocated = totalAllocated.add(s.fraction);
      });
      remainder = new Fraction(1).subtract(totalAllocated);
      
      // 9. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¯
      if (remainder.isPositive() && asabaShares.length === 0) {
        allShares = this.applyRadd(allShares, remainder);
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
        totalAllocated = new Fraction(0);
        allShares.forEach(s => {
          totalAllocated = totalAllocated.add(s.fraction);
        });
        remainder = new Fraction(1).subtract(totalAllocated);
      }
      
      // 10. Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù…
      if (remainder.isPositive()) {
        const { shares: updatedShares, bloodRelatives } = this.distributeToBloodRelatives(allShares, remainder);
        allShares = updatedShares;
        if (bloodRelatives.length > 0) {
          allShares = [...allShares, ...bloodRelatives];
        }
      }
      
      // 11. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
      this.fairRounding(allShares, netEstate);
      
      // 12. Ø­Ø³Ø§Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©
      this.calculateConfidence(allShares);
      
      // 13. ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      this.results.shares = allShares.filter(s => !s.fraction.isZero());
      
      return {
        success: true,
        madhab: this.madhab,
        madhhabName: this.config.name,
        madhhabIcon: this.config.icon,
        estate: this.estate,
        netEstate: this.results.netEstate,
        asl: this.results.asl,
        finalBase: this.results.finalBase,
        awlApplied: this.results.awlApplied,
        awlRatio: this.results.awlRatio,
        raddApplied: this.results.raddApplied,
        bloodRelativesApplied: this.results.bloodRelativesApplied,
        shares: this.results.shares,
        specialCases: this.state.specialCases,
        blockedHeirs: this.state.blockedHeirs,
        madhhabNotes: this.state.madhhabNotes,
        warnings: this.state.warnings,
        steps: this.state.steps,
        confidence: this.results.confidence
      };
      
    } catch (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø«:', error);
      return {
        success: false,
        errors: [`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨: ${error.message}`],
        madhab: this.madhab,
        madhhabName: this.config.name
      };
    }
  }
  
  // Ø­Ø³Ø§Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©
  calculateConfidence(shares) {
    let confidence = 1.0;
    
    // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø«Ù‚Ø© Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
    if (this.results.awlApplied) confidence *= 0.98;
    if (this.results.raddApplied) confidence *= 0.97;
    if (this.results.bloodRelativesApplied) confidence *= 0.95;
    if (this.state.specialCases.length > 2) confidence *= 0.96;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø­ØµØµ
    const total = shares.reduce((sum, s) => sum + s.fraction.toDecimal(), 0);
    if (Math.abs(1 - total) > 0.001) {
      confidence *= 0.90;
      this.state.warnings.push(`Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø­ØµØµ (${(total * 100).toFixed(2)}%) Ù„Ø§ ÙŠØ³Ø§ÙˆÙŠ 100% Ø¨Ø§Ù„Ø¶Ø¨Ø·`);
    }
    
    this.results.confidence = Math.max(0.80, confidence);
  }
}

// ==================== 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„ ====================
class TestSuite {
  constructor() {
    this.tests = this.loadAllTests();
    this.results = [];
  }
  
  loadAllTests() {
    return {
      // ===== Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
      basic: [
        {
          name: 'Ø²ÙˆØ¬Ø© ÙˆØ§Ø¨Ù†',
          heirs: { wife: 1, son: 1 },
          expected: { wife: 1/8, son: 7/8 }
        },
        {
          name: 'Ø²ÙˆØ¬ ÙˆØ¨Ù†Øª',
          heirs: { husband: 1, daughter: 1 },
          expected: { husband: 1/4, daughter: 1/2 }
          // Ø§Ù„Ø¨Ø§Ù‚ÙŠ 1/4 ÙŠÙØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù†Øª
        },
        {
          name: 'Ø²ÙˆØ¬ ÙˆØ§Ø¨Ù† ÙˆØ¨Ù†Øª',
          heirs: { husband: 1, son: 1, daughter: 1 },
          expected: { husband: 1/4, son: 1/2, daughter: 1/4 }
        },
        {
          name: 'Ø£Ø¨ ÙˆØ£Ù… ÙˆØ§Ø¨Ù†',
          heirs: { father: 1, mother: 1, son: 1 },
          expected: { father: 1/6, mother: 1/6, son: 4/6 }
        },
        {
          name: 'Ø²ÙˆØ¬Ø© ÙˆØ£Ø¨ ÙˆØ£Ù… ÙˆØ§Ø¨Ù†',
          heirs: { wife: 1, father: 1, mother: 1, son: 1 },
          expected: { wife: 1/8, father: 1/6, mother: 1/6 }
          // Ø§Ù„Ø§Ø¨Ù† ÙŠØ£Ø®Ø° Ø§Ù„Ø¨Ø§Ù‚ÙŠ
        },
        {
          name: 'Ø£Ø¨ ÙˆØ£Ù… ÙÙ‚Ø·',
          heirs: { father: 1, mother: 1 },
          expected: { father: 2/3, mother: 1/3 }
        },
        {
          name: 'Ø§Ø¨Ù† ÙˆØ¨Ù†ØªØ§Ù†',
          heirs: { son: 1, daughter: 2 },
          expected: { son: 1/2, daughter: 1/2 }
          // Ù„Ù„Ø°ÙƒØ± Ù…Ø«Ù„ Ø­Ø¸ Ø§Ù„Ø£Ù†Ø«ÙŠÙŠÙ†
        }
      ],
      
      // ===== Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘ØªØ§Ù† =====
      umariyyah: [
        {
          name: 'Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø²ÙˆØ¬ + Ø£Ø¨ + Ø£Ù…',
          heirs: { husband: 1, father: 1, mother: 1 },
          expected: { husband: 1/2, mother: 1/6, father: 2/6 },
          description: 'Ø§Ù„Ø£Ù… ØªØ£Ø®Ø° Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ = 1/6'
        },
        {
          name: 'Ø§Ù„Ø¹ÙÙ…ÙØ±ÙŠÙÙ‘Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø²ÙˆØ¬Ø© + Ø£Ø¨ + Ø£Ù…',
          heirs: { wife: 1, father: 1, mother: 1 },
          expected: { wife: 1/4, mother: 1/4, father: 2/4 },
          description: 'Ø§Ù„Ø£Ù… ØªØ£Ø®Ø° Ø«Ù„Ø« Ø§Ù„Ø¨Ø§Ù‚ÙŠ = 1/4'
        }
      ],
      
      // ===== Ø§Ù„Ø¹ÙˆÙ„ =====
      awl: [
        {
          name: 'Ø²ÙˆØ¬ + Ø£Ø®ØªØ§Ù† Ø´Ù‚ÙŠÙ‚ØªØ§Ù† + Ø£Ù… (Ø¹ÙˆÙ„ Ù…Ù† 6 Ø¥Ù„Ù‰ 8)',
          heirs: { husband: 1, full_sister: 2, mother: 1 },
          expected: { husband: 3/8, full_sister: 4/8, mother: 1/8 },
          awl: true
        },
        {
          name: 'Ø²ÙˆØ¬ + Ø£Ù… + Ø£Ø®ØªØ§Ù† Ù„Ø£Ù… + Ø£Ø®ØªØ§Ù† Ø´Ù‚ÙŠÙ‚ØªØ§Ù† (Ø¹ÙˆÙ„ Ù…Ù† 6 Ø¥Ù„Ù‰ 10)',
          heirs: { husband: 1, mother: 1, maternal_brother: 2, full_sister: 2 },
          expected: {},
          awl: true
        }
      ],
      
      // ===== Ø§Ù„Ø±Ø¯ =====
      radd: [
        {
          name: 'Ø£Ù… + Ø¨Ù†Øª (Ø±Ø¯)',
          heirs: { mother: 1, daughter: 1 },
          expected: { mother: 1/5, daughter: 4/5 },
          radd: true
        },
        {
          name: 'Ø¨Ù†ØªØ§Ù† ÙÙ‚Ø· (Ø±Ø¯)',
          heirs: { daughter: 2 },
          expected: { daughter: 1 },
          radd: true
        },
        {
          name: 'Ø£Ù… + Ø£Ø¨ ÙÙ‚Ø·',
          heirs: { mother: 1, father: 1 },
          expected: { mother: 1/3, father: 2/3 }
        }
      ],
      
      // ===== Ø§Ù„Ø­Ø¬Ø¨ =====
      hijab: [
        {
          name: 'Ø§Ø¨Ù† ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¥Ø®ÙˆØ©',
          heirs: { son: 1, full_brother: 2, full_sister: 1 },
          expected: { son: 1 }
        },
        {
          name: 'Ø£Ø¨ ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø¬Ø¯',
          heirs: { father: 1, grandfather: 1, son: 1 },
          expected: { father: 1/6, son: 5/6 }
        },
        {
          name: 'Ø£Ù… ØªØ­Ø¬Ø¨ Ø§Ù„Ø¬Ø¯Ø§Øª',
          heirs: { mother: 1, grandmother_mother: 1, grandmother_father: 1, son: 1 },
          expected: { mother: 1/6, son: 5/6 }
        },
        {
          name: 'Ø¨Ù†ØªØ§Ù† ØªØ­Ø¬Ø¨Ø§Ù† Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù† (Ø¨Ø¯ÙˆÙ† Ø§Ø¨Ù† Ø§Ø¨Ù†)',
          heirs: { daughter: 2, granddaughter: 1 },
          expected: { daughter: 1 }
        },
        {
          name: 'Ø¨Ù†Øª + Ø¨Ù†Øª Ø§Ø¨Ù† (Ø§Ù„Ø³Ø¯Ø³ ØªÙƒÙ…Ù„Ø©)',
          heirs: { daughter: 1, granddaughter: 1 },
          expected: { daughter: 1/2, granddaughter: 1/6 }
        }
      ],
      
      // ===== Ø§Ù„Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ± =====
      asabaWithGhayr: [
        {
          name: 'Ø¨Ù†Øª + Ø£Ø®Øª Ø´Ù‚ÙŠÙ‚Ø© (Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±)',
          heirs: { daughter: 1, full_sister: 1 },
          expected: { daughter: 1/2, full_sister: 1/2 }
        },
        {
          name: 'Ø¨Ù†ØªØ§Ù† + Ø£Ø®Øª Ø´Ù‚ÙŠÙ‚Ø©',
          heirs: { daughter: 2, full_sister: 1 },
          expected: { daughter: 2/3, full_sister: 1/3 }
        },
        {
          name: 'Ø¨Ù†Øª Ø§Ø¨Ù† + Ø£Ø®Øª Ù„Ø£Ø¨ (Ø¹ØµØ¨Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±)',
          heirs: { granddaughter: 1, paternal_sister: 1 },
          expected: { granddaughter: 1/2, paternal_sister: 1/2 }
        }
      ],
      
      // ===== Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© =====
      musharraka: [
        {
          name: 'Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©: Ø²ÙˆØ¬ + Ø£Ù… + Ø£Ø®ÙˆÙŠÙ† Ù„Ø£Ù… + Ø£Ø® Ø´Ù‚ÙŠÙ‚',
          heirs: { husband: 1, mother: 1, maternal_brother: 2, full_brother: 1 },
          expected: { husband: 1/2, mother: 1/6 },
          madhpiab: 'shafii',
          specialCase: 'musharraka'
        }
      ],
      
      // ===== Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ© =====
      akdariyya: [
        {
          name: 'Ø§Ù„Ø£ÙƒØ¯Ø±ÙŠØ©: Ø²ÙˆØ¬ + Ø£Ù… + Ø¬Ø¯ + Ø£Ø®Øª Ø´Ù‚ÙŠÙ‚Ø©',
          heirs: { husband: 1, mother: 1, grandfather: 1, full_sister: 1 },
          expected: { husband: 9/27, mother: 6/27, grandfather: 8/27, full_sister: 4/27 },
          specialCase: 'akdariyya'
        }
      ],
      
      // ===== Ø§Ù„Ø¬Ø¯ Ù…Ø¹ Ø§Ù„Ø¥Ø®ÙˆØ© =====
      grandfatherWithSiblings: [
        {
          name: 'Ø¬Ø¯ + Ø£Ø® Ø´Ù‚ÙŠÙ‚ (Ø§Ù„Ø´Ø§ÙØ¹ÙŠ - Ø§Ù„Ø¬Ø¯ ÙŠØ­Ø¬Ø¨)',
          heirs: { grandfather: 1, full_brother: 1 },
          madhab: 'shafii',
          expected: { grandfather: 1 }
        },
        {
          name: 'Ø¬Ø¯ + Ø£Ø® Ø´Ù‚ÙŠÙ‚ (Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ - Ø§Ù„Ù…Ù‚Ø§Ø³Ù…Ø©)',
          heirs: { grandfather: 1, full_brother: 1 },
          madhab: 'maliki',
          expected: { grandfather: 1/2, full_brother: 1/2 }
        }
      ],
      
      // ===== Ø­Ø§Ù„Ø§Øª Ù…Ø¹Ù‚Ø¯Ø© =====
      complex: [
        {
          name: 'Ø²ÙˆØ¬Ø© + Ø£Ø¨Ù†Ø§Ø¡ + Ø¨Ù†Ø§Øª + Ø£Ø¨ + Ø£Ù…',
          heirs: { wife: 1, son: 2, daughter: 2, father: 1, mother: 1 },
          expected: { wife: 1/8, father: 1/6, mother: 1/6 }
        },
        {
          name: 'Ø²ÙˆØ¬ + Ø¨Ù†Øª + Ø¨Ù†Øª Ø§Ø¨Ù† + Ø£Ù…',
          heirs: { husband: 1, daughter: 1, granddaughter: 1, mother: 1 },
          expected: { husband: 1/4, daughter: 1/2, granddaughter: 1/6, mother: 1/6 },
          awl: true
        }
      ],
      
      // ===== Ø°ÙˆÙˆ Ø§Ù„Ø£Ø±Ø­Ø§Ù… =====
      bloodRelatives: [
        {
          name: 'Ø®Ø§Ù„ ÙÙ‚Ø· (Ø§Ù„Ø´Ø§ÙØ¹ÙŠ)',
          heirs: { maternal_uncle: 1 },
          madhab: 'shafii',
          expected: { maternal_uncle: 1 }
        },
        {
          name: 'Ø®Ø§Ù„ ÙÙ‚Ø· (Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ - Ù„Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„)',
          heirs: { maternal_uncle: 1 },
          madhab: 'maliki',
          expected: { treasury: 1 }
        }
      ]
    };
  }
  
  async runAllTests(madhab = 'shafii') {
    this.results = [];
    let passed = 0, failed = 0;
    
    for (const [category, tests] of Object.entries(this.tests)) {
      for (const test of tests) {
        const testMadhab = test.madhab || madhab;
        const result = await this.runSingleTest(test, category, testMadhab);
        this.results.push(result);
        result.passed ? passed++ : failed++;
      }
    }
    
    return {
      total: passed + failed,
      passed,
      failed,
      coverage: ((passed / (passed + failed)) * 100).toFixed(1),
      results: this.results
    };
  }
  
  async runSingleTest(test, category, madhab) {
    try {
      const estate = { total: 120000, funeral: 0, debts: 0, will: 0 };
      const engine = new InheritanceEngine(madhab, estate, test.heirs);
      const result = engine.calculate();
      
      if (!result.success) {
        return {
          name: test.name,
          category,
          madhab,
          passed: false,
          error: result.errors?.join(', ') || 'ÙØ´Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨'
        };
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
      if (test.awl && !result.awlApplied) {
        return {
          name: test.name,
          category,
          madhab,
          passed: false,
          error: 'ÙƒØ§Ù† ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹ÙˆÙ„'
        };
      }
      
      if (test.radd && !result.raddApplied) {
        return {
          name: test.name,
          category,
          madhab,
          passed: false,
          error: 'ÙƒØ§Ù† ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¯'
        };
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
      let allPassed = true;
      const discrepancies = [];
      
      for (const [heirKey, expectedShare] of Object.entries(test.expected)) {
        const actualHeir = result.shares.find(s => 
          s.key === heirKey || 
          s.key === heirKey + 's' ||
          s.key.includes(heirKey)
        );
        
        if (!actualHeir && expectedShare > 0.001) {
          allPassed = false;
          discrepancies.push(`${heirKey}: ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ (Ù…ØªÙˆÙ‚Ø¹: ${(expectedShare * 100).toFixed(1)}%)`);
          continue;
        }
        
        if (actualHeir && expectedShare > 0) {
          const actualShare = actualHeir.fraction.toDecimal();
          const diff = Math.abs(actualShare - expectedShare);
          
          // Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ 0.5%
          if (diff > 0.005) {
            allPassed = false;
            discrepancies.push(
              `${heirKey}: ${(actualShare * 100).toFixed(2)}% (Ù…ØªÙˆÙ‚Ø¹: ${(expectedShare * 100).toFixed(2)}%)`
            );
          }
        }
      }
      
      return {
        name: test.name,
        category,
        madhab,
        passed: allPassed || Object.keys(test.expected).length === 0,
        discrepancies: discrepancies.length > 0 ? discrepancies : null,
        result: result
      };
      
    } catch (error) {
      return {
        name: test.name,
        category,
        madhab,
        passed: false,
        error: error.message
      };
    }
  }
}

// ==================== 6. Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ====================
class AuditLog {
  constructor() {
    this.entries = [];
    this.maxEntries = 500;
  }
  
  add(action, type, message, details = null) {
    const entry = {
      id: Date.now(),
      timestamp: new Date().toLocaleString('ar-SA'),
      action,
      type,
      message,
      details
    };
    
    this.entries.unshift(entry);
    
    if (this.entries.length > this.maxEntries) {
      this.entries = this.entries.slice(0, this.maxEntries);
    }
    
    this.updateDisplay();
    return entry;
  }
  
  clear() {
    this.entries = [];
    this.updateDisplay();
  }
  
  updateDisplay() {
    const container = document.getElementById('auditLogContainer');
    if (!container) return;
    
    if (this.entries.length === 0) {
      container.innerHTML = '<div class="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯...</div>';
      return;
    }
    
    container.innerHTML = this.entries.slice(0, 100).map(entry => {
      const colorClass = {
        success: 'audit-success',
        error: 'audit-error',
        warning: 'audit-warning',
        info: 'audit-info'
      }[entry.type] || 'text-gray-300';
      
      const icon = {
        success: 'âœ…',
        error: 'âŒ',
        warning: 'âš ï¸',
        info: 'â„¹ï¸'
      }[entry.type] || 'ğŸ“';
      
      return `<div class="mb-1 ${colorClass}">[${entry.timestamp}] ${icon} <strong>${entry.action}:</strong> ${entry.message}</div>`;
    }).join('');
  }
  
  export() {
    const text = this.entries.map(e =>
      `[${e.timestamp}] [${e.type.toUpperCase()}] ${e.action}: ${e.message}`
    ).join('\n');
    
    const blob = new Blob(['\uFEFF' + text], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `audit_log_${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
  }
}

// ==================== 7. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ====================
let currentMadhab = 'shafii';
let lastResult = null;
let auditLog = new AuditLog();
let testSuite = new TestSuite();

// ==================== 8. ÙˆØ¸Ø§Ø¦Ù ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ====================

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', () => {
  initTabs();
  initMadhabSelection();
  initHeirCards();
  initEventListeners();
  updateQuickPreview();
  
  auditLog.add('ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', 'success', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0 Ø§Ù„Ù…ÙØµØ­ÙÙ‘Ø­');
  
  console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 5.0 Ø¬Ø§Ù‡Ø²');
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function initTabs() {
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const tabId = btn.dataset.tab;
      
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      tabContents.forEach(content => content.classList.add('hidden'));
      document.getElementById(`tab-${tabId}`)?.classList.remove('hidden');
      
      auditLog.add('ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨', 'info', `Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰: ${tabId}`);
    });
  });
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø°Ù‡Ø¨
function initMadhabSelection() {
  document.querySelectorAll('.madhab-card').forEach(card => {
    card.addEventListener('click', () => {
      const madhab = card.dataset.madhab;
      selectMadhab(madhab);
    });
  });
}

function selectMadhab(madhab) {
  currentMadhab = madhab;
  
  document.querySelectorAll('.madhab-card').forEach(c => c.classList.remove('selected'));
  document.querySelector(`[data-madhab="${madhab}"]`)?.classList.add('selected');
  
  const config = FIQH_DATABASE.madhabs[madhab];
  const infoDiv = document.getElementById('madhhabInfo');
  
  // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ ÙØ¦Ø§Øª Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨
  infoDiv.className = 'p-4 rounded-xl';
  infoDiv.classList.add(`madhab-info-${madhab}`);
  
  infoDiv.innerHTML = `
    <h3 class="font-bold mb-2">Ø§Ù„Ù…Ø°Ù‡Ø¨ ${config.name}</h3>
    <p class="text-sm">${config.description}</p>
  `;
  
  document.getElementById('previewMadhab').textContent = config.name;
  
  auditLog.add('ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø°Ù‡Ø¨', 'info', `ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø°Ù‡Ø¨ ${config.name}`);
}

// ØªÙ‡ÙŠØ¦Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø©
function initHeirCards() {
  document.querySelectorAll('input, select').forEach(el => {
    el.addEventListener('change', updateHeirCard);
    el.addEventListener('input', updateHeirCard);
  });
}

function updateHeirCard(event) {
  const el = event.target;
  const cardId = `card-${el.id}`;
  const card = document.getElementById(cardId);
  
  if (card) {
    const value = parseFloat(el.value) || 0;
    card.classList.toggle('active', value > 0);
  }
  
  updateQuickPreview();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
function updateQuickPreview() {
  const estate = readEstateData();
  const heirs = readHeirsData();
  
  const netEstate = Math.max(0, estate.total - estate.funeral - estate.debts - estate.will);
  const heirsCount = Object.values(heirs).reduce((a, b) => a + b, 0);
  
  document.getElementById('previewNet').textContent = netEstate.toLocaleString();
  document.getElementById('previewHeirs').textContent = heirsCount;
}

// Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ÙƒØ©
function readEstateData() {
  return {
    total: parseFloat(document.getElementById('estateTotal')?.value) || 0,
    funeral: parseFloat(document.getElementById('funeralCosts')?.value) || 0,
    debts: parseFloat(document.getElementById('debts')?.value) || 0,
    will: parseFloat(document.getElementById('willAmount')?.value) || 0
  };
}

// Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø©
function readHeirsData() {
  const heirIds = [
    'husband', 'wife', 'father', 'mother', 'grandfather',
    'grandmother_mother', 'grandmother_father',
    'son', 'daughter', 'grandson', 'granddaughter',
    'full_brother', 'full_sister', 'paternal_brother', 'paternal_sister',
    'maternal_brother', 'maternal_sister',
    'full_nephew', 'paternal_nephew', 'full_uncle', 'paternal_uncle',
    'full_cousin', 'paternal_cousin',
    'maternal_uncle', 'maternal_aunt', 'paternal_aunt',
    'daughter_son', 'daughter_daughter', 'sister_children'
  ];
  
  const heirs = {};
  heirIds.forEach(id => {
    const el = document.getElementById(id);
    heirs[id] = el ? parseInt(el.value) || 0 : 0;
  });
  
  return heirs;
}

// ØªÙ‡ÙŠØ¦Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function initEventListeners() {
  document.getElementById('calculateBtn')?.addEventListener('click', calculateInheritance);
  document.getElementById('validateBtn')?.addEventListener('click', validateInputs);
  document.getElementById('resetBtn')?.addEventListener('click', resetCalculator);
  document.getElementById('exampleBtn')?.addEventListener('click', loadExample);
  document.getElementById('toggleExtended')?.addEventListener('click', toggleExtendedHeirs);
  
  document.querySelectorAll('.quick-test').forEach(btn => {
    btn.addEventListener('click', () => loadQuickTest(btn.dataset.test));
  });
  
  document.getElementById('runCompareBtn')?.addEventListener('click', runComparison);
  document.getElementById('runAllTestsBtn')?.addEventListener('click', runAllTests);
  document.getElementById('exportTestsBtn')?.addEventListener('click', exportTestResults);
  
  document.getElementById('clearAuditBtn')?.addEventListener('click', () => {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ')) {
      auditLog.clear();
      auditLog.add('Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„', 'warning', 'ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
    }
  });
  document.getElementById('exportAuditBtn')?.addEventListener('click', () => auditLog.export());
  document.getElementById('refreshAuditBtn')?.addEventListener('click', () => auditLog.updateDisplay());
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø«
function calculateInheritance() {
  hideError();
  
  try {
    const estate = readEstateData();
    const heirs = readHeirsData();
    
    if (estate.total <= 0) {
      throw new Error('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ±ÙƒØ©');
    }
    
    if (Object.values(heirs).every(v => v === 0)) {
      throw new Error('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ø±Ø« ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
    }
    
    const engine = new InheritanceEngine(currentMadhab, estate, heirs);
    const result = engine.calculate();
    
    if (result.success) {
      lastResult = result;
      displayResults(result);
      auditLog.add('Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø«', 'success',
        `ØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„ØªØ±ÙƒØ©: ${estate.total.toLocaleString()} - Ø§Ù„Ù…Ø°Ù‡Ø¨: ${result.madhhabName}`
      );
    } else {
      throw new Error(result.errors?.join('\n') || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨');
    }
    
  } catch (error) {
    console.error('Ø®Ø·Ø£:', error);
    showError(error.message);
    auditLog.add('Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø«', 'error', error.message);
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø£
function showError(message) {
  const errorSection = document.getElementById('errorSection');
  const errorMessage = document.getElementById('errorMessage');
  
  if (errorSection && errorMessage) {
    errorMessage.textContent = message;
    errorSection.classList.remove('hidden');
    document.getElementById('resultsSection')?.classList.add('hidden');
    errorSection.scrollIntoView({ behavior: 'smooth' });
  } else {
    alert(`âŒ Ø®Ø·Ø£: ${message}`);
  }
}

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø·Ø£
function hideError() {
  document.getElementById('errorSection')?.classList.add('hidden');
}

// ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù†Øµ Ù…Ù† XSS
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function displayResults(result) {
  const section = document.getElementById('resultsSection');
  const mainResults = document.getElementById('mainResults');
  
  document.getElementById('resultMadhab').textContent = result.madhhabName;
  
  let statusText = 'Ø¹Ø§Ø¯ÙŠØ©';
  if (result.awlApplied) statusText = 'Ø¹Ø§Ø¦Ù„Ø©';
  else if (result.raddApplied) statusText = 'Ø±Ø§Ø¯Ù‘Ø©';
  document.getElementById('resultStatus').textContent = statusText;
  
  const confidenceBadge = document.getElementById('resultConfidence');
  if (result.confidence > 0.95) {
    confidenceBadge.textContent = 'Ø«Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©';
    confidenceBadge.className = 'badge bg-green-100 text-green-800';
  } else if (result.confidence > 0.90) {
    confidenceBadge.textContent = 'Ø«Ù‚Ø© Ø¬ÙŠØ¯Ø©';
    confidenceBadge.className = 'badge bg-blue-100 text-blue-800';
  } else {
    confidenceBadge.textContent = 'ØªØªØ·Ù„Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø©';
    confidenceBadge.className = 'badge bg-yellow-100 text-yellow-800';
  }
  
  // Ø¨Ù†Ø§Ø¡ HTML Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø©
  let html = '';
  
  // Ù…Ù„Ø®Øµ Ø§Ù„ØªØ±ÙƒØ©
  html += `
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="p-4 bg-gray-50 rounded-xl text-center">
        <div class="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ±ÙƒØ©</div>
        <div class="text-xl font-bold">${escapeHtml(result.estate.total.toLocaleString())}</div>
      </div>
      <div class="p-4 bg-red-50 rounded-xl text-center">
        <div class="text-sm text-gray-500">Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</div>
        <div class="text-xl font-bold text-red-600">${escapeHtml((result.estate.funeral + result.estate.debts + result.estate.will).toLocaleString())}</div>
      </div>
      <div class="p-4 bg-green-50 rounded-xl text-center">
        <div class="text-sm text-gray-500">ØµØ§ÙÙŠ Ø§Ù„ØªØ±ÙƒØ©</div>
        <div class="text-xl font-bold text-green-600">${escapeHtml(result.netEstate.toLocaleString())}</div>
      </div>
      <div class="p-4 bg-indigo-50 rounded-xl text-center">
        <div class="text-sm text-gray-500">Ø£ØµÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©</div>
        <div class="text-xl font-bold text-indigo-600">${escapeHtml(String(result.finalBase))}</div>
        ${result.awlApplied ? `<div class="text-xs text-amber-600">Ø¹Ø§Ù„Øª Ù…Ù† ${result.asl}</div>` : ''}
      </div>
    </div>
  `;
  
  // Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
  if (result.warnings && result.warnings.length > 0) {
    html += `
      <div class="alert alert-warning mb-6">
        <h4 class="font-bold mb-2">âš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª</h4>
        ${result.warnings.map(w => `<p class="text-sm">â€¢ ${escapeHtml(w)}</p>`).join('')}
      </div>
    `;
  }
  
  // Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
  if (result.specialCases.length > 0) {
    html += `
      <div class="alert alert-info mb-6">
        <h4 class="font-bold mb-2">âš¡ Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ©</h4>
        ${result.specialCases.map(c => `<p class="text-sm"><strong>${escapeHtml(c.name)}:</strong> ${escapeHtml(c.description)}</p>`).join('')}
      </div>
    `;
  }
  
  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø°Ù‡Ø¨ÙŠØ©
  if (result.madhhabNotes && result.madhhabNotes.length > 0) {
    html += `
      <div class="alert alert-success mb-6">
        <h4 class="font-bold mb-2">ğŸ“š Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø°Ù‡Ø¨ÙŠØ©</h4>
        ${result.madhhabNotes.map(n => `<p class="text-sm">â€¢ ${escapeHtml(n)}</p>`).join('')}
      </div>
    `;
  }
  
  // Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ†
  if (result.blockedHeirs.length > 0) {
    html += `
      <div class="alert alert-danger mb-6">
        <h4 class="font-bold mb-2">ğŸš« Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ†</h4>
        <div class="flex flex-wrap gap-2">
          ${result.blockedHeirs.map(b => `
            <span class="badge badge-blocked">${escapeHtml(FIQH_DATABASE.heirNames[b.heir] || b.heir)}: ${escapeHtml(b.reason)}</span>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  const colors = ['#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#ec4899', '#84cc16'];
  
  html += `
    <div class="overflow-x-auto mb-6">
      <table class="w-full">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-4 text-right font-semibold">Ø§Ù„ÙˆØ§Ø±Ø«</th>
            <th class="p-4 text-center font-semibold">Ø§Ù„Ø¹Ø¯Ø¯</th>
            <th class="p-4 text-center font-semibold">Ø§Ù„Ù†ÙˆØ¹</th>
            <th class="p-4 text-center font-semibold">Ø§Ù„Ø­ØµØ©</th>
            <th class="p-4 text-center font-semibold">Ø§Ù„Ù†Ø³Ø¨Ø©</th>
            <th class="p-4 text-left font-semibold">Ø§Ù„Ù…Ø¨Ù„Øº</th>
          </tr>
        </thead>
        <tbody>
  `;
  
  let totalAmount = 0;
  
  result.shares.forEach((share, index) => {
    const badgeClass = share.type.includes('Ø¹ØµØ¨Ø©') ? 'badge-asaba' :
                       share.type.includes('Ø±Ø¯') ? 'badge-radd' :
                       share.type.includes('Ø±Ø­Ù…') ? 'badge-relative' : 'badge-fard';
    
    const percentage = (share.fraction.toDecimal() * 100).toFixed(2);
    const color = colors[index % colors.length];
    
    html += `
      <tr class="border-b hover:bg-gray-50">
        <td class="p-4">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" style="background:${color}"></div>
            <div>
              <div class="font-medium">${escapeHtml(share.name)}</div>
              <div class="text-xs text-gray-500">${escapeHtml(share.reason)}</div>
            </div>
          </div>
        </td>
        <td class="p-4 text-center">${escapeHtml(String(share.count))}</td>
        <td class="p-4 text-center"><span class="badge ${badgeClass}">${escapeHtml(share.type)}</span></td>
        <td class="p-4 text-center font-mono">${escapeHtml(share.fraction.toArabic())}</td>
        <td class="p-4 text-center">${escapeHtml(percentage)}%</td>
        <td class="p-4 text-left font-bold text-green-600">${escapeHtml(share.amount.toLocaleString())}</td>
      </tr>
    `;
    
    if (share.count > 1) {
      html += `
        <tr class="bg-gray-50 text-sm">
          <td class="p-2 pr-12" colspan="5">â†³ Ù„ÙƒÙ„ ÙØ±Ø¯: ${escapeHtml(share.getPerPerson().toArabic())}</td>
          <td class="p-2 text-left text-gray-600">${escapeHtml(share.amountPerPerson.toLocaleString())}</td>
        </tr>
      `;
    }
    
    totalAmount += share.amount;
  });
  
  html += `
        </tbody>
        <tfoot>
          <tr class="bg-indigo-50 font-bold">
            <td class="p-4" colspan="4">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</td>
            <td class="p-4 text-center">100%</td>
            <td class="p-4 text-left text-green-600">${escapeHtml(totalAmount.toLocaleString())}</td>
          </tr>
        </tfoot>
      </table>
    </div>
  `;
  
  // Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
  html += `
    <div class="mb-6">
      <h4 class="font-bold mb-3">ğŸ“Š Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¦ÙŠ</h4>
      <div class="bg-gray-100 rounded-xl p-4">
        <div class="h-8 rounded-lg overflow-hidden flex">
          ${result.shares.map((share, i) => {
            const pct = share.fraction.toDecimal() * 100;
            const color = colors[i % colors.length];
            return pct > 0 ? `<div class="chart-bar h-full" style="width:${pct}%;background:${color}" title="${escapeHtml(share.name)}: ${pct.toFixed(1)}%"></div>` : '';
          }).join('')}
        </div>
        <div class="flex flex-wrap gap-3 mt-3">
          ${result.shares.map((share, i) => {
            const pct = share.fraction.toDecimal() * 100;
            const color = colors[i % colors.length];
            return pct > 0 ? `
              <div class="flex items-center gap-1 text-sm">
                <div class="w-3 h-3 rounded" style="background:${color}"></div>
                <span>${escapeHtml(share.name)}: ${pct.toFixed(1)}%</span>
              </div>
            ` : '';
          }).join('')}
        </div>
      </div>
    </div>
  `;
  
  // Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
  if (result.steps && result.steps.length > 0) {
    html += `
      <div class="mb-6">
        <h4 class="font-bold mb-3">ğŸ“ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h4>
        <div class="space-y-2">
          ${result.steps.map((step, i) => `
            <div class="flex gap-3 p-3 bg-gray-50 rounded-lg">
              <div class="w-6 h-6 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">${i + 1}</div>
              <div>
                <div class="font-medium">${escapeHtml(step.title)}</div>
                <div class="text-sm text-gray-600">${escapeHtml(step.description)}</div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
  html += `
    <div class="flex flex-wrap gap-3 pt-4 border-t">
      <button onclick="exportCSV()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
        ğŸ“„ ØªØµØ¯ÙŠØ± CSV
      </button>
      <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
        ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
      </button>
      <button onclick="copyResults()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm">
        ğŸ“‹ Ù†Ø³Ø®
      </button>
    </div>
  `;
  
  mainResults.innerHTML = html;
  section.classList.remove('hidden');
  section.scrollIntoView({ behavior: 'smooth' });
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
function validateInputs() {
  const estate = readEstateData();
  const heirs = readHeirsData();
  const errors = [], warnings = [];
  
  if (estate.total <= 0) errors.push('Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ±ÙƒØ© Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±');
  if (estate.funeral < 0 || estate.debts < 0 || estate.will < 0) errors.push('Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ù„Ø¨ÙŠØ© ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­Ø©');
  
  const remaining = estate.total - estate.funeral - estate.debts;
  if (remaining > 0 && estate.will > remaining / 3) {
    warnings.push(`Ø§Ù„ÙˆØµÙŠØ© (${estate.will.toLocaleString()}) ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø«Ù„Ø« (${(remaining / 3).toLocaleString()})`);
  }
  
  if (Object.values(heirs).every(v => v === 0)) errors.push('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ø±Ø« ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
  if (heirs.husband > 0 && heirs.wife > 0) errors.push('Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙˆØ¬ÙˆØ¯ Ø²ÙˆØ¬ ÙˆØ²ÙˆØ¬Ø© Ù…Ø¹Ø§Ù‹');
  
  if (errors.length > 0) {
    showError('Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n' + errors.join('\n'));
    auditLog.add('Ø§Ù„ØªØ­Ù‚Ù‚', 'error', `${errors.length} Ø®Ø·Ø£`);
  } else if (warnings.length > 0) {
    alert('âš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª:\n' + warnings.join('\n') + '\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.');
    auditLog.add('Ø§Ù„ØªØ­Ù‚Ù‚', 'warning', `${warnings.length} ØªØ­Ø°ÙŠØ±`);
  } else {
    alert('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©!');
    auditLog.add('Ø§Ù„ØªØ­Ù‚Ù‚', 'success', 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©');
  }
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
function resetCalculator() {
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
  
  document.getElementById('estateTotal').value = '100000';
  document.getElementById('funeralCosts').value = '0';
  document.getElementById('debts').value = '0';
  document.getElementById('willAmount').value = '0';
  
  document.querySelectorAll('.heir-card input, .heir-card select').forEach(el => {
    el.value = '0';
  });
  
  document.querySelectorAll('.heir-card').forEach(card => card.classList.remove('active'));
  document.getElementById('resultsSection')?.classList.add('hidden');
  hideError();
  
  updateQuickPreview();
  auditLog.add('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†', 'info', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
}

// ØªØ­Ù…ÙŠÙ„ Ù…Ø«Ø§Ù„
function loadExample() {
  resetFormSilent();
  document.getElementById('estateTotal').value = '120000';
  document.getElementById('husband').value = '1';
  document.getElementById('son').value = '1';
  document.getElementById('daughter').value = '2';
  document.getElementById('father').value = '1';
  
  updateAllHeirCards();
  updateQuickPreview();
  auditLog.add('ØªØ­Ù…ÙŠÙ„ Ù…Ø«Ø§Ù„', 'info', 'Ø²ÙˆØ¬ + Ø§Ø¨Ù† + Ø¨Ù†ØªØ§Ù† + Ø£Ø¨');
  
  calculateInheritance();
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹
function loadQuickTest(testType) {
  resetFormSilent();
  
  const tests = {
    basic: { husband: 1, daughter: 1 },
    awl: { husband: 1, full_sister: 2, mother: 1 },
    radd: { mother: 1, daughter: 1 },
    umariyyah1: { husband: 1, father: 1, mother: 1 },
    umariyyah2: { wife: 1, father: 1, mother: 1 },
    musharraka: { husband: 1, mother: 1, maternal_brother: 2, full_brother: 1 },
    akdariyya: { husband: 1, mother: 1, grandfather: 1, full_sister: 1 },
    complex: { wife: 1, son: 2, daughter: 2, father: 1 }
  };
  
  const heirs = tests[testType];
  if (heirs) {
    for (const [key, value] of Object.entries(heirs)) {
      const el = document.getElementById(key);
      if (el) el.value = value;
    }
  }
  
  updateAllHeirCards();
  updateQuickPreview();
  auditLog.add('Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹', 'info', `ØªØ­Ù…ÙŠÙ„: ${testType}`);
  
  calculateInheritance();
}

// Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠÙŠÙ†
function toggleExtendedHeirs() {
  const container = document.getElementById('extendedHeirs');
  const icon = document.getElementById('toggleIcon');
  
  if (container && icon) {
    container.classList.toggle('hidden');
    icon.style.transform = container.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(-90deg)';
  }
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ØµØ§Ù…ØªØ©
function resetFormSilent() {
  document.getElementById('estateTotal').value = '100000';
  document.getElementById('funeralCosts').value = '0';
  document.getElementById('debts').value = '0';
  document.getElementById('willAmount').value = '0';
  
  document.querySelectorAll('.heir-card input, .heir-card select').forEach(el => {
    el.value = '0';
  });
  
  hideError();
}

// ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø©
function updateAllHeirCards() {
  document.querySelectorAll('.heir-card').forEach(card => {
    const input = card.querySelector('input, select');
    if (input) {
      const value = parseFloat(input.value) || 0;
      card.classList.toggle('active', value > 0);
    }
  });
}

// Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨
function runComparison() {
  const estate = readEstateData();
  const heirs = readHeirsData();
  
  if (estate.total <= 0 || Object.values(heirs).every(v => v === 0)) {
    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ÙƒØ© ÙˆØ§Ù„ÙˆØ±Ø«Ø© Ø£ÙˆÙ„Ø§Ù‹');
    return;
  }
  
  const results = {};
  const madhabs = ['shafii', 'hanafi', 'maliki', 'hanbali'];
  
  madhabs.forEach(madhab => {
    try {
      const engine = new InheritanceEngine(madhab, estate, { ...heirs });
      results[madhab] = engine.calculate();
    } catch (e) {
      results[madhab] = { success: false, error: e.message };
    }
  });
  
  // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„ÙˆØ±Ø«Ø©
  const allHeirs = new Set();
  Object.values(results).forEach(r => {
    if (r.success && r.shares) {
      r.shares.forEach(s => allHeirs.add(s.key));
    }
  });
  
  // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  const tbody = document.getElementById('comparisonBody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  allHeirs.forEach(heirKey => {
    const row = document.createElement('tr');
    row.className = 'border-b';
    
    let cells = `<td class="p-3 font-medium">${escapeHtml(FIQH_DATABASE.heirNames[heirKey] || heirKey)}</td>`;
    
    madhabs.forEach(madhab => {
      const result = results[madhab];
      const share = result.success && result.shares ? result.shares.find(s => s.key === heirKey) : null;
      
      const bgColors = {
        shafii: '#ecfdf5',
        hanafi: '#fef2f2',
        maliki: '#faf5ff',
        hanbali: '#eff6ff'
      };
      
      cells += `<td class="p-3 text-center" style="background:${bgColors[madhab]}">
        ${share ? `
          <div class="font-mono">${escapeHtml(share.fraction.toArabic())}</div>
          <div class="text-sm text-gray-600">${escapeHtml(share.amount.toLocaleString())}</div>
        ` : '-'}
      </td>`;
    });
    
    row.innerHTML = cells;
    tbody.appendChild(row);
  });
  
  // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  const notes = document.getElementById('comparisonNotes');
  if (notes) {
    const allNotes = [];
    
    Object.entries(results).forEach(([madhab, r]) => {
      if (r.success) {
        r.madhhabNotes?.forEach(n => allNotes.push(n));
        r.specialCases?.forEach(c => allNotes.push(`${FIQH_DATABASE.madhabs[madhab].name}: ${c.name}`));
      }
    });
    
    notes.innerHTML = [...new Set(allNotes)].map(n =>
      `<div class="p-3 bg-gray-50 rounded-lg text-sm">${escapeHtml(n)}</div>`
    ).join('') || '<p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±ÙˆÙ‚ Ø¬ÙˆÙ‡Ø±ÙŠØ©</p>';
  }
  
  document.getElementById('comparisonResults')?.classList.remove('hidden');
  auditLog.add('Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨', 'success', 'ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©');
}

// ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
async function runAllTests() {
  const container = document.getElementById('testResultsContainer');
  if (!container) return;
  
  container.innerHTML = '<div class="text-center py-8 animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...</div>';
  
  const selectedMadhab = document.getElementById('testMadhabSelect')?.value || 'shafii';
  const results = await testSuite.runAllTests(selectedMadhab);
  
  document.getElementById('testsPassed').textContent = results.passed;
  document.getElementById('testsFailed').textContent = results.failed;
  document.getElementById('testsTotal').textContent = results.total;
  document.getElementById('testsCoverage').textContent = results.coverage + '%';
  
  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  let html = '';
  
  const byCategory = {};
  results.results.forEach(r => {
    if (!byCategory[r.category]) byCategory[r.category] = [];
    byCategory[r.category].push(r);
  });
  
  for (const [category, tests] of Object.entries(byCategory)) {
    const passed = tests.filter(t => t.passed).length;
    const total = tests.length;
    
    html += `
      <div class="mb-6">
        <h3 class="font-bold mb-3 flex items-center justify-between">
          <span>${escapeHtml(category)}</span>
          <span class="text-sm ${passed === total ? 'text-green-600' : 'text-red-600'}">${passed}/${total}</span>
        </h3>
        <div class="space-y-2">
          ${tests.map(t => `
            <div class="p-3 rounded-lg ${t.passed ? 'test-pass' : 'test-fail'}">
              <div class="flex justify-between items-center">
                <span class="font-medium">${t.passed ? 'âœ…' : 'âŒ'} ${escapeHtml(t.name)}</span>
                <span class="text-sm text-gray-500">${escapeHtml(t.madhab)}</span>
              </div>
              ${t.discrepancies ? `<div class="text-sm text-red-600 mt-1">${t.discrepancies.map(d => escapeHtml(d)).join(' | ')}</div>` : ''}
              ${t.error ? `<div class="text-sm text-red-600 mt-1">${escapeHtml(t.error)}</div>` : ''}
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  container.innerHTML = html;
  auditLog.add('Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', results.failed === 0 ? 'success' : 'warning',
    `${results.passed}/${results.total} Ù†Ø§Ø¬Ø­ (${results.coverage}%)`);
}

// ØªØµØ¯ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
function exportTestResults() {
  if (testSuite.results.length === 0) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±. Ø´ØºÙ‘Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
    return;
  }
  
  const text = testSuite.results.map(r =>
    `[${r.passed ? 'PASS' : 'FAIL'}] ${r.category} - ${r.name}${r.error ? ': ' + r.error : ''}`
  ).join('\n');
  
  const blob = new Blob(['\uFEFF' + text], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `test_results_${new Date().toISOString().split('T')[0]}.txt`;
  a.click();
  URL.revokeObjectURL(url);
  
  auditLog.add('ØªØµØ¯ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', 'success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
}

// ØªØµØ¯ÙŠØ± CSV
function exportCSV() {
  if (!lastResult) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±');
    return;
  }
  
  const rows = [['Ø§Ù„ÙˆØ§Ø±Ø«', 'Ø§Ù„Ø¹Ø¯Ø¯', 'Ø§Ù„Ù†ÙˆØ¹', 'Ø§Ù„Ø­ØµØ©', 'Ø§Ù„Ù†Ø³Ø¨Ø©', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ù„Ù„ÙØ±Ø¯']];
  
  lastResult.shares.forEach(s => {
    rows.push([
      s.name,
      s.count,
      s.type,
      s.fraction.toString(),
      (s.fraction.toDecimal() * 100).toFixed(2) + '%',
      s.amount.toFixed(2),
      s.amountPerPerson.toFixed(2)
    ]);
  });
  
  const csv = '\uFEFF' + rows.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `inheritance_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  
  auditLog.add('ØªØµØ¯ÙŠØ± CSV', 'success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±');
}

// Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function copyResults() {
  if (!lastResult) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù†Ø³Ø®');
    return;
  }
  
  let text = `Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø« - Ø§Ù„Ù…Ø°Ù‡Ø¨ ${lastResult.madhhabName}\n`;
  text += `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}\n`;
  text += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
  text += `ØµØ§ÙÙŠ Ø§Ù„ØªØ±ÙƒØ©: ${lastResult.netEstate.toLocaleString()}\n`;
  text += `Ø£ØµÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${lastResult.finalBase}\n`;
  if (lastResult.awlApplied) text += `(Ø¹Ø§Ù„Øª Ù…Ù† ${lastResult.asl})\n`;
  text += `\nØ§Ù„Ø£Ù†ØµØ¨Ø©:\n`;
  
  lastResult.shares.forEach(s => {
    text += `â€¢ ${s.name}: ${s.fraction.toString()} = ${s.amount.toLocaleString()}\n`;
    if (s.count > 1) {
      text += `  (Ù„ÙƒÙ„ ÙØ±Ø¯: ${s.amountPerPerson.toLocaleString()})\n`;
    }
  });
  
  if (lastResult.specialCases.length > 0) {
    text += `\nØ­Ø§Ù„Ø§Øª Ø®Ø§ØµØ©:\n`;
    lastResult.specialCases.forEach(c => {
      text += `â€¢ ${c.name}: ${c.description}\n`;
    });
  }
  
  navigator.clipboard.writeText(text).then(() => {
    alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
    auditLog.add('Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬', 'success', 'ØªÙ… Ø§Ù„Ù†Ø³Ø®');
  }).catch(() => {
    alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®');
  });
}

// ==================== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ====================
console.log('ğŸš€ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 5.0 - ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
</script>
</body>
</html>




