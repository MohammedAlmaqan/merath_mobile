# ุชุญุฏูุซ ุญุงุณุจุฉ ุงูููุงุฑูุซ - ููุฎุต ุงูุชุบููุฑุงุช

## ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ: v3 (ูุชุทุงุจู ูุน ุงููุดุฑูุน ุงูููุจ)

### โ ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ

#### 1. ูุธุงู ุงููุณูุฑ ุงูููุญุณููู (Fraction Class)
- **ุงูุนูููุงุช ุงูุญุณุงุจูุฉ**: ุฌูุนุ ุทุฑุญุ ุถุฑุจุ ูุณูุฉ
- **ุงูุญุณุงุจุงุช ุงููุชูุฏูุฉ**: 
  - GCD (ุงููุงุณู ุงููุดุชุฑู ุงูุฃูุจุฑ)
  - LCM (ุงููุถุงุนู ุงููุดุชุฑู ุงูุฃุตุบุฑ)
  - ูุตูููุงุช LCM ูุญุณุงุจุงุช ุงูุนูู
- **ุงูุชุญูููุงุช**:
  - ุชุญููู ุฅูู ุนุดุฑู (toDecimal)
  - ุชุญููู ุฅูู ูุต (toString)
  - ุฑููุฒ ูุณูุฑ ุนุฑุจูุฉ (toArabic)
- **ุงูููุงุฑูุงุช**: <, >, <=, >=, equals
- **ุงูุซูุงุจุช ุงูููุนุฑููุฉ ูุณุจูุงู**: ZERO, ONE, HALF, THIRD, QUARTER, SIXTH, EIGHTH, TWO_THIRDS

#### 2. ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูููููุฉ (FIQH_DATABASE)
**ุงููุฐุงูุจ ุงููุฏุนููุฉ:**
- ๐ข **ุงูุดุงูุนู**: ุงูุฑุฏ ุนูู ุฃุตุญุงุจ ุงููุฑูุถ ุนุฏุง ุงูุฒูุฌูู
- ๐ด **ุงูุญููู**: ุงูุฑุฏ ุนูู ุงูุฒูุฌูู ุนูุฏ ุนุฏู ูุฌูุฏ ุบูุฑูู
- ๐ฃ **ุงููุงููู**: ุงูุฌุฏ ูููุงุณู ุงูุฅุฎูุฉ
- ๐ต **ุงูุญูุจูู**: ุงูุฌุฏ ูููุงุณู ุงูุฅุฎูุฉ ูููุฑุฏ ุนูู ุงูุฒูุฌูู

**ุชูููู ูู ูุฐูุจ:**
- ูุนุฑูู ูุฑูุฏ (ID)
- ุงูุงุณู ุงูุนุฑุจู
- ุงูููู ุงููููุฒ
- ุงููุตู
- ุงูููุงุนุณ ุงููุฐูุจูุฉ (ุฑุฏ ุนูู ุงูุฒูุฌููุ ูุนุงููุฉ ุงูุฌุฏ ูุน ุงูุฅุฎูุฉุ ุฅูุฎ)

**ูุงุฆูุฉ ุฃุณูุงุก ุงููุฑุซุฉ:** 18 ููุน ูุงุฑุซ ูุฎุชูู

#### 3. ูุฆุฉ ูุชูุฌุฉ ุงููุงุฑุซ (HeirShare)
```typescript
class HeirShare {
  key: string;                    // ูุนุฑูู ูุฑูุฏ
  name: string;                   // ุงูุงุณู ุงูุนุฑุจู
  type: string;                   // ููุน ุงูุญุตุฉ (ูุฑุถุ ุนุตุจุฉุ ุฑุฏุ ุฅูุฎ)
  count: number;                  // ุนุฏุฏ ุงููุฑุซุฉ ูู ูุฐุง ุงูููุน
  fraction: Fraction;             // ุงูุญุตุฉ ุงููุณุฑูุฉ
  originalFraction: Fraction;     // ุงูุญุตุฉ ูุจู ุงูุนูู
  reason: string;                 // ุงูุณุจุจ ุงููููู ููุญุตุฉ
  blocked: boolean;               // ูู ุชู ุญุฌุจ ูุฐุง ุงููุงุฑุซุ
  blockedBy: string | null;       // ูู ูุงู ุจุญุฌุจูุ
  amount: number;                 // ุงููุจูุบ ุงูููุฏู
  amountPerPerson: number;        // ุงููุจูุบ ููู ูุฑุฏ
}
```

#### 4. ูุญุฑู ุงูุญุณุงุจ ุงููุชูุงูู (InheritanceEngine)

**ุงูุจูุงูุงุช ุงููุฏุฎูุฉ:**
```typescript
interface EstateData {
  total: number;      // ุฅุฌูุงูู ุงูุชุฑูุฉ
  funeral: number;    // ุชูุงููู ุงูุชุฌููุฒ ูุงูุฏูู
  debts: number;      // ุงูุฏููู
  will: number;       // ุงููุตูุฉ (ุญุฏ ุฃูุตู ุซูุซ)
}

interface HeirsData {
  // 18 ููุน ูุงุฑุซ ูุฎุชูู
}
```

**ุนูููุงุช ุงููุญุฑู:**

1. **ุงูุชุญูู ูู ุงูุตุญุฉ** (`validateEstate`)
   - ุงูุชุญูู ูู ูููุฉ ุงูุชุฑูุฉ > 0
   - ุงูุชุญูู ูู ุฃู ุงููุตูุฉ โค ุงูุซูุซ
   - ุญุณุงุจ ุตุงูู ุงูุชุฑูุฉ

2. **ุชุทุจูุน ุงูุจูุงูุงุช** (`normalizeHeirs`)
   - ุชุทุจูู ุงููููุฏ ุนูู ุงูุญุฏ ุงูุฃูุตู (ุฒูุฌ ูุงุญุฏุ 4 ุฒูุฌุงุชุ ุฅูุฎ)
   - ุงูุชุญูู ูู ุงูุชุนุงุฑุถุงุช (ูุง ูููู ูุฌูุฏ ุฒูุฌ ูุฒูุฌุฉ ูุนุงู)

3. **ุชุทุจูู ุงูุญุฌุจ** (`applyHijab`)
   - ุญุฌุจ ุงูุฌุฏ ุจุงูุฃุจ (12 ูุงุนุฏุฉ ุญุฌุจ)
   - ุญุฌุจ ุงูุฌุฏุงุช ุจุงูุฃู
   - ุญุฌุจ ุงูุฃุญูุงุฏ ุจุงูุฃุจูุงุก
   - ุญุฌุจ ุงูุฅุฎูุฉ ุจุงููุฑุน ุงููุงุฑุซ ุงูุฐูุฑ ุฃู ุงูุฃุจ
   - ุญุฌุจ ุงูุฅุฎูุฉ ุจุงูุฌุฏ (ุญุณุจ ุงููุฐูุจ)

4. **ุญุณุงุจ ุงููุฑูุถ** (`computeFixedShares`)
   - ุงูุฒูุฌ/ุงูุฒูุฌุฉ (ยฝ ุฃู ยผ)
   - ุงูุฃุจ (โ)
   - ุงูุฃู (โ ุฃู โ)
   - ุงูุฌุฏ (โ)
   - ุงูุฃุจูุงุก ูุงูุจูุงุช
   - ุงูุฃุญูุงุฏ ูุงูุญููุฏุงุช
   - ุงูุฅุฎูุฉ ูุงูุฃุฎูุงุช (ุฌููุน ุงูุฏุฑุฌุงุช)

5. **ุชุทุจูู ุงูุนูู** (`applyAwl`)
   - ุญุณุงุจ ุฃุตู ุงููุณุฃูุฉ (LCM)
   - ุงูุชุดุงู ุงูุนูู (ูุฌููุน ุงูุณูุงู > ุงูุฃุตู)
   - ุชูุฒูุน ุงูุณูุงู ุนูู ุงูุฃุตู ุงูุนุงุฆู

6. **ุญุณุงุจ ุงููุจุงูุบ**
   - ุชุญููู ุงููุณุจ ุงููุณุฑูุฉ ุฅูู ูุจุงูุบ ููุฏูุฉ
   - ุญุณุงุจ ุงููุจูุบ ููู ูุงุฑุซ
   - ุญุณุงุจ ุงููุจูุบ ููู ูุฑุฏ ุนูุฏ ุชุนุฏุฏ ุงููุงุฑุซูู

**ุงูุญุงูุงุช ุงูุฎุงุตุฉ:**
- ุงูุนูููุฑูููุฉ (ุฒูุฌ + ุฃุจ + ุฃู ุจุฏูู ุฃุจูุงุก)
- ุงูุนูู (ุนุงูุช ุงููุณุฃูุฉ)

#### 5. ุงููุชุงุฆุฌ ุงูุดุงููุฉ (CalculationResult)
```typescript
interface CalculationResult {
  success: boolean;                               // ูุฌุญ ุงูุญุณุงุจุ
  madhab: string;                                 // ุงููุฐูุจ ุงููุฎุชุงุฑ
  madhhabName: string;                            // ุงุณู ุงููุฐูุจ
  madhhabColor?: string;                          // ููู ุงููุฐูุจ
  estate: EstateData;                             // ุงูุชุฑูุฉ ุงูุฃุตููุฉ
  netEstate: number;                              // ุตุงูู ุงูุชุฑูุฉ
  asl: number;                                    // ุฃุตู ุงููุณุฃูุฉ ุงูุฃุตูู
  finalBase: number;                              // ุฃุตู ุงููุณุฃูุฉ ุงูููุงุฆู (ุจุนุฏ ุงูุนูู)
  awlApplied: boolean;                            // ูู ุชู ุชุทุจูู ุงูุนููุ
  awlRatio?: Fraction;                            // ูุณุจุฉ ุงูุนูู
  raddApplied: boolean;                           // ูู ุชู ุชุทุจูู ุงูุฑุฏุ
  bloodRelativesApplied: boolean;                 // ูู ุชู ุชูุฒูุน ุนูู ุฐูู ุงูุฃุฑุญุงูุ
  shares: HeirShare[];                            // ุญุตุต ุงููุฑุซุฉ
  specialCases: Array<{type, name, description}>; // ุงูุญุงูุงุช ุงูุฎุงุตุฉ
  blockedHeirs: Array<{heir, by, reason}>;       // ุงููุฑุซุฉ ุงููุญุฌูุจูู
  madhhabNotes: string[];                         // ููุงุญุธุงุช ูุฐูุจูุฉ
  warnings: string[];                             // ุชุญุฐูุฑุงุช
  steps: Array<{title, description, details}>;   // ุฎุทูุงุช ุงูุญุณุงุจ
  confidence: number;                             // ุฏุฑุฌุฉ ุงูุซูุฉ (0-1)
  errors?: string[];                              // ุงูุฃุฎุทุงุก ุฅู ูุฌุฏุช
}
```

### ๐ฏ ุฃููุงุน ุงููุฑุซุฉ ุงููุฏุนููุฉ (18 ููุน)

| ุงููุจููุฉ | ุงูุฃููุงุน |
|--------|--------|
| ุงูุฒูุฌูุฉ | ุงูุฒูุฌุ ุงูุฒูุฌุฉ |
| ุงูุขุจุงุก | ุงูุฃุจุ ุงูุฃูุ ุงูุฌุฏุ ุงูุฌุฏุฉ ูุฃูุ ุงูุฌุฏุฉ ูุฃุจ |
| ุงูุฃุจูุงุก | ุงูุงุจูุ ุงูุจูุชุ ุงุจู ุงูุงุจูุ ุจูุช ุงูุงุจู |
| ุงูุฅุฎูุฉ | ุงูุฃุฎ ุงูุดูููุ ุงูุฃุฎุช ุงูุดูููุฉุ ุงูุฃุฎ ูุฃุจุ ุงูุฃุฎุช ูุฃุจุ ุงูุฃุฎ ูุฃูุ ุงูุฃุฎุช ูุฃู |

### ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู

```typescript
import { calculateInheritance } from './lib/inheritance-calculator';

const result = calculateInheritance('shafii', {
  total: 120000,
  funeral: 2000,
  debts: 5000,
  will: 10000
}, {
  husband: 1,
  son: 1,
  daughter: 2,
  father: 1,
  mother: 1
});

if (result.success) {
  console.log(`ุตุงูู ุงูุชุฑูุฉ: ${result.netEstate}`);
  console.log(`ุฃุตู ุงููุณุฃูุฉ: ${result.finalBase}`);
  console.log(`ุญุตุต ุงููุฑุซุฉ:`);
  
  result.shares.forEach(share => {
    console.log(`- ${share.name}: ${share.fraction.toString()} = ${share.amount}`);
  });
  
  console.log(`ุฎุทูุงุช ุงูุญุณุงุจ:`);
  result.steps.forEach((step, i) => {
    console.log(`${i+1}. ${step.title}: ${step.description}`);
  });
}
```

### ๐ ุงูููุฒุงุช ุงูุฅุถุงููุฉ

1. **ุฎุทูุงุช ุงูุญุณุงุจ ุงูุชูุตูููุฉ**
   - ุชุณุฌูู ูู ุฎุทูุฉ ูู ุฎุทูุงุช ุงูุญุณุงุจ
   - ูุตู ููุตู ููู ุนูููุฉ
   - ุทุงุจุน ุฒููู ูููุฑุงุฌุนุฉ

2. **ุงูุชุชุจุน ุงูุดุงูู**
   - ุชุณุฌูู ุงููุฑุซุฉ ุงููุญุฌูุจูู ูุน ุงูุณุจุจ
   - ุชุญุฐูุฑุงุช ูู ุงููุฏุฎูุงุช ุบูุฑ ุงููุงููุฉ
   - ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

3. **ุฏุนู ุงููุฐุงูุจ ุงููุชุนุฏุฏุฉ**
   - ูุชุงุฆุฌ ูุฎุชููุฉ ุญุณุจ ุงููุฐูุจ
   - ููุงุนุฏ ูุฐูุจูุฉ ูุญุฏุฏุฉ ูุณุจูุงู
   - ุฃููุงู ูููุฒุฉ ููู ูุฐูุจ

4. **ุฏูุฉ ุนุงููุฉ**
   - ุนูููุงุช ุญุณุงุจูุฉ ุจุงุณุชุฎุฏุงู ุงููุณูุฑ (ูุง ููุฏุงู ุฏูุฉ)
   - ุญูุงูุฉ ูู ุงูุชุถุฎู ุงูุฑููู
   - ูุนุงูุฑุฉ ุชููุงุฆูุฉ ูููุณูุฑ

### ๐ ุงูุชุญุณููุงุช ุนู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู

| ุงูููุฒุฉ | ุงูุฅุตุฏุงุฑ ุงูุณุงุจู | ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ |
|--------|----------------|----------------|
| ุงููุณูุฑ | ุจุณูุทุฉ | ูุชูุฏูุฉ ูุน GCD/LCM |
| ุงููุฐุงูุจ | ูุงุญุฏ | 4 ูุฐุงูุจ ูุงููุฉ |
| ุงูุญุงูุงุช ุงูุฎุงุตุฉ | ูุนุฏููุฉ | ุงูุนูููุฑูููุฉ + ุงูุนูู |
| ุงูุญุฌุจ | 5 ููุงุนุฏ | 12 ูุงุนุฏุฉ ุดุงููุฉ |
| ุงููุฑุซุฉ | 8 ุฃููุงุน | 18 ููุน |
| ุงูุณุฌูุงุช | ูุง ููุฌุฏ | ุฎุทูุงุช ููุตูุฉ + ุชุชุจุน |
| ุงูุฃุฎุทุงุก | ุฑุณุงุฆู ุจุณูุทุฉ | ุชุญุฐูุฑุงุช ูุชุตุญูุญุงุช |

### โจ ุงููููุงุช ุงููุนุฏูุฉ

- `/workspaces/merath_mobile/lib/inheritance-calculator.ts` โ ูุญุฏุซ ุจุงููุงูู (500+ ุณุทุฑ)

### ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุงูููุชุฑุญ ุชุทููุฑ ูุงุฌูุฉ ูุณุชุฎุฏู ุชุนุฑุถ:
1. ุฌุฏูู ุชูุฒูุน ุงูุญุตุต ุจุฃููุงู ุงููุฐุงูุจ
2. ุฑุณู ุจูุงูู ูุชูุฒูุน ุงูุชุฑูุฉ
3. ุฎุทูุงุช ุงูุญุณุงุจ ุงูุชูุตูููุฉ
4. ุงูููุงุฑูุฉ ุจูู ุงููุฐุงูุจ ุงูุฃุฑุจุนุฉ
5. ุชูุฑูุฑ ูุงุจู ููุชุตุฏูุฑ (PDF/CSV)
6. ุณุฌู ุงููุฑุงุฌุนุฉ ุงููุงูู

---

**ููุงุญุธุฉ**: ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ูุนุงูุฑุฉ ูููุงู ููููู ุงูุฅุณูุงูู ุงูุดุฑุนู ูุงููุฐุงูุจ ุงูุฃุฑุจุนุฉ ุงููุนุชูุฏุฉ.
